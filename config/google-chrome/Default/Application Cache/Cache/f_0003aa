function HQb(a,b,c,d){var e=null;a.j.every(function(a,h,l){if(b&&(h>c||h==c&&l>=d))return!1;a.isEmpty()||(e=new G(l,h));return!0});return e}function IQb(a,b,c){var d=null;a.j.some(function(a,f,h){return(f>b||f==b&&h>c)&&!a.isEmpty()?(d=new G(h,f),!0):!1});return d}function JQb(a,b,c){var d=0,e=-1;b&&(d=b.y,e=b.x);var f=null;return f=c?HQb(a,!!b,d,e):IQb(a,d,e)}
function KQb(a,b){if(!b)return null;var c=null;a.j.some(function(a,e,f){a=a.kd();for(var h=0;h<a.length;h++)if(a[h]==b)return c=new G(f,e),!0;return!1});return c}function LQb(a){var b=new ed;a.j.forEach(function(a){a.isEmpty()||fd(b,a.kd())});return b.kd()}function MQb(a,b){var c=a.j.Yd(b.y,b.x);return c?c.kd():[]}function NQb(a,b){var c=Ls(a.k);Tb(a.L,function(a,e){var f=this.B.To(a);Number(e)==c&&b?im(f,"docs-icon-comment-blank-highlighted"):km(f,"docs-icon-comment-blank-highlighted")},a)}
function i7(a){return a.j.hasUnpostedDocos()}function OQb(a,b){for(var c=[],d=0;d<b.length;d++)c.push(a.k.j[b[d]]||0);a.j.deleteDocoPositions(c)}function PQb(a,b){var c={},d;for(d in b){var e=a.k.j[d]||0;e&&a.j.hasDoco(e)&&(c[e]=b[d])}return c}function QQb(a){return a.j};function RQb(a){this.j={};if(a)for(var b in a)this.set(b,a[b])}RQb.prototype.get=function(a){if(!(a in this.j))throw Error("No value for key "+a);return this.j[a]};RQb.prototype.set=function(a,b){this.j[a]=b};function SQb(a){this.j=new RQb;this.o=a||null}SQb.prototype.k=function(a){try{var b=Md(a)}catch(c){return this.o&&this.o.log(Error("Invalid serialized anchor ID")),null}return this.j.get(b.type).j(b)};SQb.prototype.Nc=function(a){return Pd(this.j.get(a.getType()).Nc(a))};function j7(a,b){this.o=a;this.k=b}j7.prototype.getType=g("o");function k7(a){j7.call(this,"range",0);this.q=a}C(k7,j7);k7.prototype.j=g("q");function TQb(){}ia(TQb);TQb.prototype.j=function(a){return new k7(a.range)};TQb.prototype.Nc=function(a){var b={};b.type=a.getType();b.uid=a.k;b.range=a.j();return b};function UQb(a,b){j7.call(this,"workbook-range",0);this.A=a;this.q=!!b}C(UQb,j7);UQb.prototype.j=g("A");function VQb(){}ia(VQb);VQb.prototype.j=function(a){return new UQb(a.range)};VQb.prototype.Nc=function(a){var b={};b.type=a.q?"range":"workbook-range";b.uid=a.k;b.range=a.j();return b};function l7(){SQb.call(this);var a=TQb.getInstance();this.j.set("range",a);a=VQb.getInstance();this.j.set("workbook-range",a)}C(l7,SQb);ia(l7);l7.prototype.k=function(a){return(a=l7.G.k.call(this,a))?a:null};function m7(a,b){if(!b)return null;var c=b.j();return"range"==b.getType()?(c=a.j[c],WQb(c)?c.Xa().Bd():null):(c=XQb(b))&&YQb(ZQb(c))?ZQb(c).Bd():null}function XQb(a){var b=new qo,c;try{c=ritz.getWorkbookRangeById(a.j(),!0)}catch(d){}return c?b.Ck((new Li).Z(),ritz.getWorkbookRangeById(a.j(),!0)):null}function ZQb(a){return new yf(a.fb(),a.hb(),a.wb(),a.zb())}
function n7(a,b,c){return c?"range"==c.getType()?(b=b.j[c.j()],WQb(b)?(b=b.ob(),null!=b?$Qb(a,b):null):null):(b=XQb(c))&&YQb(ZQb(b))?$Qb(a,parseInt(b.gb(),10)):null:null}function $Qb(a,b){var c=Yt(a,b);return c?c.Sb():null}function WQb(a){return!!a&&a.j&&YQb(a.Xa())}function YQb(a){return!!a&&1==a.height&&1==a.width&&Rf(a)};function aRb(a,b,c,d,e,f,h,l,m,n,p){K.call(this);this.q=a;this.ga=b;this.X=c;this.ua=d;this.C=e;this.Ra=f;this.o=h;this.xa=l;this.j=m;this.O=n;this.B=b.L;this.k=b.j;this.A=b.A;this.F=l7.getInstance();this.L={};this.J=new ed;this.U=new Xs(0);a=[this.U];Ib(p.k,a);KTa(p,a);p.j=JTa(p.k);vN(p);this.H=new R(this);bRb(this)}C(aRb,K);u=aRb.prototype;u.rca=!1;
function bRb(a){var b=lb(St,function(a){return!Zta[a]});a.H.D(a.ua,"activity-box-closed",a.VXa).D(a.C,"mouseover",o7(a,a.I2a)).D(a.C,"click",o7(a,a.H2a)).D(a.C,"selectionChange",o7(a,a.J2a)).D(a.C,"inputBoxActivate",o7(a,a.F2a)).D(a.k,"b",o7(a,a.Dhb)).D(a.o,"view-comments",a.K0a).D(a.o,"comment-indicator-hover-start",a.I0a).D(a.o,"comment-indicator-hover-end",a.H0a).D(a.C,"insert_doco",a.Ahb).D(new Uu(a.xa),"mousewheel",a.Bhb).D(a.A,["add_named_range","delete_named_range"],a.zYa).D(a.ga,"docos_change",
a.N2a).D(a.O,"me",a.xRa).D(a.k,"a",a.wpa);var c=sv(a.k);a.H.D(c,b,a.G2a);a.H.D(c,["Fa"],o7(a,a.Chb));pJ(a.q,Docos.EventType.HOVER,o7(a,a.cUa));pJ(a.q,Docos.EventType.SELECTED,o7(a,a.zhb));pJ(a.q,Docos.EventType.CREATED,a.coa,a);pJ(a.q,Docos.EventType.UNRESOLVED,a.coa,a);pJ(a.q,Docos.EventType.DELETED,a.doa,a);pJ(a.q,Docos.EventType.RESOLVED,a.doa,a);pJ(a.q,Docos.EventType.POSTED,a.tUa,a);pJ(a.q,Docos.EventType.PENDING,a.pZa,a);U.zr.Zc(or,B(a.DWa,a));T.Dt.Zc(or,B(a.pRa,a));T.YR.Va("action",B(a.qYa,
a));T.ZR.Va("action",B(a.xYa,a));T.$R.Va("action",B(a.yYa,a));a.wpa()}u.wpa=function(){var a=xK(this.k);T.YR.Y(a);T.ZR.Y(a);T.$R.Y(a)};u.DWa=function(){this.q.setOption(Docos.OptionName.READONLY,!this.ga.Sp())};function o7(a,b){return B(function(a){this.rca||b.call(this,a)},a)}
u.Ahb=function(){var a,b=DD(this.k),c=sw(b);c&&!i7(this.q)&&!cRb(this,b,c)&&(a=Gcb(this.A),this.Ra.Pb(new Es(this.A,a,a,b.ob(),Bf(c),this.k,!0)),a=this.F.Nc(new k7(a)),a=p7(this,a))&&(this.j.dispatchEvent(new q7("te",[a],c)),this.X.j(2))};function cRb(a,b,c){c=MQb(zD(a.B,b),c);return c.length?(b=a.q,a=a.F.Nc(c[0]),b.j.highlightDoco(b.k.j[a]||0,!0),!0):!1}u.coa=function(a){E(a.j,function(a){r7(this,!0,a);this.J.add(a)},this)};u.doa=function(a){E(a.j,function(a){r7(this,!1,a);this.J.remove(a)},this)};
function r7(a,b,c,d,e){c=p7(a,c);d=d||n7(a.k,a.A,c);e=e||m7(a.A,c);if(c&&d&&e){var f=zD(a.B,d);if(b){var h=f.j.Yd(e.y,e.x)||new ed;h.add(c);uv(f.j,e.y,e.x,h)}else(h=f.j.Yd(e.y,e.x))&&h.remove(c);f.k.dispatchEvent(Pt(Bf(e)));a.k.getActiveGrid()&&(d=d==DD(a.k),b?(a=a.j,(b=d?e:null)&&lf(b,a.FH)&&a.j.add(c),a.dispatchEvent(new q7("ne",[c],b))):(a=a.j,(b=d?e:null)&&lf(b,a.FH)&&a.j.remove(c),a.Tq==c&&(a.Tq=null),a.dispatchEvent(new q7("ve",[c],b))))}else a.j.dispatchEvent("xe")}
function p7(a,b){if(!b)return null;if(!a.L[b]){var c=a.F.k(b);c&&(a.L[b]=c)}return a.L[b]}u.Dhb=function(){this.j.reset()};u.cUa=function(a){a=p7(this,a.j.length?a.j[0]:null);var b=m7(this.A,a);this.j.dispatchEvent(new q7("re",[a],b))};u.tUa=ba();u.pZa=function(){var a=this.U,b=this.q.j.hasPendingContent();wq(a,xq(a.$,4,b))};u.VXa=function(){this.X.j(3)};
u.zhb=function(a){if(!i7(this.q)){var b=p7(this,a.j.length?a.j[0]:null),c=m7(this.A,b);b&&c?(this.rca=!0,dRb(this.j,b,c)):b||a.q?this.j.reset():b||this.X.j(3)}};u.xRa=function(){this.rca=!1};u.J2a=function(){if(!this.O.isEmpty()&&!i7(this.q)){this.X.j(3);var a=this.j,b=sw(DD(this.k));lf(a.rJ,b)||!a.Tq&&!a.Rj&&lf(a.FH,b)||(s7(a),a.dispatchEvent(new q7("qe",[],b)))}};
u.H2a=function(){var a=DD(this.k);if(!i7(this.q)&&a){var b=zD(this.B,a),c=(a=sw(a))?MQb(b,a):[];c.length&&(b=this.j,c=c[0],lf(b.rJ,a)?(s7(b),b.dispatchEvent(new q7("oe",[],a))):b.dispatchEvent(new q7("oe",[c],a)))}};u.F2a=function(){i7(this.q)||this.j.reset()};u.Chb=function(){eRb(this.j)};u.G2a=function(){eRb(this.j)};
u.zYa=function(a){var b=a.Ge;if(b&&b.j)if(WQb(b)){var c;c=b.getId();c=this.F.Nc(new k7(c));a="add_named_range"==a.type;if(!a||this.J.contains(c)){var d=b.ob();b.Fe()&&null!=d&&(d=$Qb(this.k,d))&&r7(this,a,c,d,b.Xa().Bd())}}else this.j.dispatchEvent("xe")};
u.N2a=function(a){a=a.docos||[];Kb(a);for(var b=0;b<a.length;b++){var c=this.F.Nc(new UQb(a[b]));if(c){var d=p7(this,c),e;t:{e=this.B;if(d){var f=void 0;for(f in e.j){var h=e.j[f],l=KQb(h,d);if(l){e={Oa:h.Sb(),coord:l};break t}}}e=null}e?(r7(this,!1,c,e.Oa,e.coord),r7(this,!0,c),this.j.dispatchEvent("xe")):this.J.contains(c)&&r7(this,!0,c)}}};
u.I2a=function(a){var b=DD(this.k);if(b){if((a=a.Dh)&&!sy(a)){var c=xl(b,a.y,a.x);a=c?c.Bd():a}else a=null;b=zD(this.B,b);b=a?MQb(b,a):[];c=this.j;c.j.clear();fd(c.j,b);c.FH=a;c.dispatchEvent(new q7("pe",b,a))}};u.K0a=function(){if(!i7(this.q)){var a=this.j;if(a.Rj&&a.ZO)a.ZO=!1;else{var b=!a.Rj;s7(a);a.Rj=b;a.dispatchEvent("ue")}}};u.I0a=function(){if(!i7(this.q)){var a=this.j;a.Rj||(s7(a),a.ZO=!0,a.Rj=!0,a.dispatchEvent("ue"))}};u.H0a=function(){if(!i7(this.q)){var a=this.j;a.Rj&&a.ZO&&(s7(a),a.dispatchEvent("ue"))}};
u.Bhb=function(a){a.stopPropagation()};u.dPa=function(a){var b=p7(this,a);a=n7(this.k,this.A,b);if(!b||!a)return"";b=m7(this.A,b);a=ew(a,b).getDisplayValue();500<a.length&&(a=a.substring(0,499),a+="\u2026");return a};u.pRa=function(){var a;a=this.q;var b=a.j.getLinkedDoco();if(a=a.k.k[b]||null||"")(a=p7(this,a))?(b=m7(this.A,a),dRb(this.j,a,b)):T.Dt.fireAction()};u.qYa=function(){var a=DD(this.k);cRb(this,a,sw(a))};u.xYa=function(){fRb(this,!1)};u.yYa=function(){fRb(this,!0)};
function fRb(a,b){for(var c=gRb(a,b),d=gx(a.k),e=DD(a.k),f=sw(e),h=zD(a.B,e),f=JQb(h,f,b),l=d;!f&&null!==l&&(l=c(l),e=l.Sb(),h=zD(a.B,e),f=JQb(h,null,b),l=l.Ed,l!=d););f&&null!==l&&(c=MQb(h,f)[0],Lt(a.k,l,B(a.Ehb,a,e,c,f)))}function gRb(a,b){var c;c=b?B(a.k.sV,a.k):B(a.k.pV,a.k);return function(a){return c(a,0,!0,!0)}}u.Ehb=function(a,b,c){dRb(this.j,b,c);ww(a,c)};
u.I=function(){delete this.C;delete this.xa;delete this.F;delete this.L;delete this.q;delete this.B;delete this.A;delete this.Ra;delete this.k;delete this.ga;M(this.U);delete this.U;M(this.O);delete this.O;M(this.j);delete this.j;M(this.H);delete this.H;aRb.G.I.call(this)};function q7(a,b,c){N.call(this,a);this.docos=b;this.o=b.length?b[0]:null;this.J=c||null}C(q7,N);function hRb(){O.call(this);this.j=new ed}C(hRb,O);u=hRb.prototype;u.FH=null;u.rJ=null;u.Tq=null;u.Rj=!1;u.ZO=!1;function dRb(a,b,c){s7(a);a.Tq=b;a.rJ=c;a.dispatchEvent(new q7("se",[b],c))}function eRb(a){a.Rj||a.Tq||s7(a);a.dispatchEvent("ye")}u.reset=function(){s7(this);this.dispatchEvent("we")};function s7(a){a.FH=null;a.j.clear();a.rJ=null;a.Tq=null;a.Rj=!1;a.ZO=!1}u.I=function(){delete this.FH;delete this.j;delete this.rJ;delete this.Tq;hRb.G.I.call(this)};function iRb(){ro.call(this,305,null)}C(iRb,ro);iRb.prototype.exec=function(){Mn.dispatchEvent("docosTickle")};function t7(a,b){K.call(this);this.k=a;this.j=new R(this);this.j.D(b,"y",this.q);this.j.D(Mn,"docosTickle",this.o)}C(t7,K);t7.prototype.q=function(a){!Co(a.F)&&Co(a.k)&&this.k.sync()};t7.prototype.o=function(){this.k.sync()};t7.prototype.I=function(){delete this.k;M(this.j);delete this.j;t7.G.I.call(this)};function jRb(a,b,c,d,e,f,h,l){cB.call(this,a,b,c,d,e,f,h,2,0,l)}C(jRb,cB);jRb.prototype.ua=function(a){return OCa(this,a,"range-border cell-border waffle-docos-target-cell-border")};function kRb(a,b,c,d,e,f,h){O.call(this);this.q=a;this.xa=b;this.A=c;this.o=d;this.C=e;this.j=f;this.J=b.L;this.k=b.j;this.F=b.A;this.H=l7.getInstance();this.ga=h||kh();this.B=new ed;this.L=new ed;this.X=new ed;this.O=new ed;this.U=new R(this);lRb(this);this.U.D(this.k,"a",this.Ihb).D(this.j,"pe",this.nSa).D(this.j,"qe",this.qSa).D(this.j,"oe",this.lSa).D(this.j,"re",this.dUa).D(this.j,"se",this.Fhb).D(this.j,"ye",this.Hhb).D(this.j,"we",this.Ghb).D(this.j,"te",this.sUa).D(this.j,"xe",this.A_a).D(this.j,
"ne",this.bUa).D(this.j,"ve",this.eUa).D(this.j,"ue",this.sZa);mRb(this)}C(kRb,O);u=kRb.prototype;u.Zr=null;u.u5="none";u.o$=500;u.HQ=!1;u.bUa=function(a){var b=a.o;b&&nRb(this,[b]);oRb(this,a.o)};u.eUa=function(a){var b=a.o;b&&pRb(this,[b]);oRb(this,a.o)};function oRb(a,b){var c=n7(a.k,a.F,b);if(c){var d=zD(a.J,c);qTa(a.o,c.ob(),LQb(d).length)}else qRb(a)}u.sZa=function(){u7(this);this.j.Rj&&rRb(this)};u.qSa=function(){u7(this)};
u.lSa=function(a){if(a.o){var b=a.o;this.HQ=!0;a=this.q;b=this.H.Nc(b);a.j.highlightDoco(a.k.j[b]||0,void 0);this.HQ=!1}else u7(this)};u.Hhb=function(){var a=this.j.Tq,b=this.B.isEmpty();this.j.Rj?rRb(this):a?(sRb(this,[a]),b&&!this.B.isEmpty()&&(this.HQ=!0,b=this.q,a=this.H.Nc(a),b.j.highlightDoco(b.k.j[a]||0,void 0),this.HQ=!1)):b||u7(this)};u.Ghb=function(){u7(this)};
function u7(a){a.B.clear();var b=a.q;b.j.flushDocoPositions(PQb(b,{}));b=a.q;b.j.highlightDoco(b.k.j[""]||0,void 0);P(a.C,!1);M(a.Zr);tRb(a);uRb(a);a.j.Rj||vRb(a);NQb(a.o,a.j.Rj);mRb(a)}u.isEmpty=function(){return this.B.isEmpty()&&this.X.isEmpty()&&this.L.isEmpty()&&this.O.isEmpty()};function mRb(a){var b=dv(a.A);b&&(a.o$=mz(b.k)/2,a.q.setOption(Docos.OptionName.MAX_DOCO_HEIGHT,a.o$))}function uRb(a){Hg(a.X.kd());a.X.clear()}function tRb(a){Hg(a.L.kd());a.L.clear()}
function vRb(a){E(a.O.kd(),function(a){km(a,"waffle-docos-target-cell-header")});a.O.clear()}u.nSa=function(a){this.j.Tq||this.j.Rj||(a=a.docos,a.length?sRb(this,a):wRb(this,!1))};function sRb(a,b){i7(a.q)||pRb(a,gd(a.B,b).kd());nRb(a,b)}function rRb(a){var b=DD(a.k);b&&(b=zD(a.J,b),sRb(a,LQb(b)),xRb(a),yRb(a))}u.Fhb=function(a){zRb(this,a.o,a.J)};
function zRb(a,b,c,d){var e=n7(a.k,a.F,b);if(e){var f=e.ob();if(ARb(a,b)){var h=BRb(a,c),l=function(){CRb(this,c)&&!h.equals(tw(e))?(Aw(e,h),zRb(this,b,c,d)):(ew(e,c).j&&oI(dv(this.A)).setVisible(!1),DRb(this,c),sRb(this,[b]),tRb(this),uRb(this),vRb(this),ERb(this,c),NQb(this.o,this.j.Rj),d&&hh(function(){this.q.j.grabFocus()},0,this),this.dispatchEvent("me"))};Re?Rq(hv(Yt(a.k,f)),B(e.jr,e,h)).addCallback(l,a):Tq(hv(Yt(a.k,f)),B(e.jr,e,h),B(l,a),new R)}else hx(a.k,f,B(function(){this.q.j.grabFocus();
zRb(this,b,c,!0)},a))}else a.dispatchEvent("me")}function DRb(a,b){var c=DD(a.k),d=dv(a.A);if(!a.HQ&&c&&d){var e=d.k,d=d.j,f=zz(e,"waffle",!1,!1),h=212;if(!e.Ob()){var l=uh("docs-docos-activitybox");l&&Nk(l)&&(h+=f.right-Lk(l).left)}l=FRb(a,b);h=l.x-f.right+h;f=l.y-f.bottom+a.o$;if(!(0>=h&&0>=f)){d=d.j.Bd();for(d=Af(d.y,d.x,d.y,d.x);Az(e,d).height<f;)Bda(d,1);for(;Az(e,d).width<h;)Cda(d,1);e=d.height;d=d.width;Bw(c,eka(c,Bl(c,qw(c),d,e)))}}}
function CRb(a,b){var c=DD(a.k);return Xv(pl(c,"r"),b.y)&&Xv(pl(c,"c"),b.x)}function BRb(a,b){return xl(DD(a.k),b.y,b.x)||Bf(b)}
u.dUa=function(a){if(!this.j.Rj&&(tRb(this),ARb(this,a.o)&&(wRb(this,!0),this.j.Tq!=a.o))){var b=this.H.Nc(a.o),c=this.q;c.j.isDocoResolved(c.k.j[b]||0)?(b=a.J,a=dv(this.A),(c=DD(this.k))&&a&&b&&(b=xl(c,b.y,b.x)||Bf(b),b=BH(a,b,"waffle-docos-target-cell-resolved-rect"),Ay(CH(a),b,!0),b.setVisible(!0),this.L.add(b))):(c=a.J,a=dv(this.A),(b=DD(this.k))&&a&&c&&(c=xl(b,c.y,c.x)||Bf(c),b=new jRb(b,a.C,a.J,a.B,a.k,a.j,new Lz(c),this.ga),Ay(CH(a),b,!0),this.L.add(b),b.setVisible(!0)))}};
function GRb(a,b){b&&(im(b,"waffle-docos-target-cell-header"),a.O.add(b))}function ERb(a,b){var c=dv(a.A),d=DD(a.k);d&&c&&b&&(d=xl(d,b.y,b.x)||Bf(b),d=BH(c,d,"waffle-docos-target-cell-rect"),Ay(CH(c),d,!0),a.X.add(d),d.setVisible(!0),d.getElement()&&a.U.D(d.getElement(),["click","contextmenu","dblclick","mousedown","mouseup"],function(a){a.Dh=b;c.dispatchEvent(a)}))}function xRb(a){uRb(a);var b={};E(a.B.kd(),function(a){a=m7(this.F,a);var d=a.x+"-"+a.y;b[d]||(ERb(this,a),b[d]=!0)},a)}
function yRb(a){vRb(a);var b=DD(a.k),c=dv(a.A);if(b&&c){var d=c.B,c=c.j,b=zD(a.J,b),e=c.jf("r"),f=c.Og("r"),h=c.jf("c"),l=c.Og("c");E(LQb(b),function(a){a=m7(this.F,a);a.x>=h&&a.x<=l&&GRb(this,yy(d,a.x));a.y>=e&&a.y<=f&&GRb(this,xy(d,a.y))},a)}}u.A_a=function(){qRb(this)};function qRb(a){var b=mb($b(a.J.j),Number);E(b,function(a){var b=$Qb(this.k,a);b&&(b=zD(this.J,b),qTa(this.o,a,LQb(b).length))},a)}u.sUa=function(a){if(a.o){var b=this.H.Nc(a.o);a=FRb(this,a.J);this.q.j.newDoco(b,a)}};
function nRb(a,b){for(var c={},d=[],e={},f=0;f<b.length;f++){var h=b[f],l=a.H.Nc(h),m;m=a;var n=h;if(dv(m.A)&&ARb(m,n)){var p=m7(m.F,n);m=HRb(m,BRb(m,p))?m.j.Rj||m.j.Tq==n||tb(m.j.j.kd(),n):!1}else m=!1;m?(m=m7(a.F,h),n=m=BRb(a,m),n=n.fb()+"-"+n.wb()+"-"+n.hb()+"-"+n.zb()+"-"+n.k+"-"+n.j,e[n]=e[n]||0,c[l]=FRb(a,m.Bd(),e[n]),e[n]++,a.B.add(h)):d.push(h)}a.B.isEmpty()||wRb(a,!0);cc(c)||(e=a.q,e.j.updateDocoPositions(PQb(e,c)));i7(a.q)||pRb(a,d)}
function pRb(a,b){var c=a.B.lm(b).kd();a.B.Fb(c);c=mb(c,function(a){return this.H.Nc(a)},a);c.length&&OQb(a.q,c);a.B.isEmpty()&&wRb(a,!1)}
function FRb(a,b,c){var d=dv(a.A),e=DD(a.k),f=d.k,h=f.Ob(),l=BRb(a,b),m=Bz(f,l),n=c?15*c:0;c=h?m.left-n:m.right+n;var l=m.top+n,p=a.j.Rj;a=lf(a.j.rJ,b);var r=ew(e,b).j;p||a||!r?(b=l+125,0<b-mz(f)&&(e=e.Pn("r")-1,xz(f,b,"r","waffle")>=e&&(l-=50))):(a=oI(d),p=a.Fq,KNa(d,kw(e,b).Bd()),e=a.C.height?a.Tb:0,b=a.F.height,d=Math.min(vCa.height,e+b),b&&(d=d+30+12,d+=QA.top,d+=QA.bottom),e&&(d+=12,d+=QA.top,d+=QA.bottom),e=d,Gz(a,p),l+=e);m=h?m.right+n+212:m.left-n-212;n=h?0>c-212:c+212>lz(f);e=h?m>lz(f):0>
m;n&&!e&&(c=m);return new Docos.Point(h?rz(f,c,"c"):c,l)}function ARb(a,b){var c=n7(a.k,a.F,b),d=DD(a.k);return!!c&&c==d}function HRb(a,b){if(!b)return!1;var c=QQb(dv(a.A)),d=!1,e=b.Bd();zda(b,function(a,b){var l;if(l=a==e.y)l=null!=$G(c,new G(b,a));return l?d=!0:!1});return d}u.Ihb=function(){lRb(this)};function lRb(a){var b=dv(a.A);b&&(a.ga.appendChild(b.bea,a.C),a.q.setOption(Docos.OptionName.LAYOUT_RTL,b.k.Ob()),a.q.setOption(Docos.OptionName.ANCHOR_DIV,a.C),a.q.j.renderAnchorSurface())}
function wRb(a,b){var c,d=a.C.style;c="";"opacity"in d?c=d.opacity:"MozOpacity"in d?c=d.MozOpacity:"filter"in d&&(d=d.filter.match(/alpha\(opacity=([\d.]+)\)/))&&(c=String(d[1]/100));c=""==c?c:Number(c);c=sa(c)?1:c;Nk(a.C)||(c=0);d=b&&1>c?"in":!b&&0<c?"out":"none";"none"==d?(M(a.Zr),P(a.C,b)):a.Zr&&1==a.Zr.$&&a.u5==d||(M(a.Zr),P(a.C,!0),a.Zr=new Jx(a.C,c,"in"==d?1:0,250),a.u5=d,"out"==d&&Yg(a.Zr,"finish",B(a.ZUa,a)),a.Zr.play())}u.ZUa=function(){u7(this);var a=dv(this.A);a&&GH(a)};
u.I=function(){delete this.A;delete this.C;delete this.H;delete this.q;delete this.B;delete this.j;delete this.J;delete this.ga;delete this.u5;delete this.F;delete this.k;delete this.xa;M(this.Zr);delete this.Zr;uRb(this);tRb(this);vRb(this);M(this.U);delete this.U;kRb.G.I.call(this)};function IRb(a,b,c,d,e,f){K.call(this);this.F=a;this.J=x(b)?b:!0;this.H=x(c)?c:1;this.o=new Xp(B(this.ELa,this),d||1E3,e||6E4,f);L(this,this.o);this.A=new Pl(void 0,this);this.j=null;this.B=[];this.q="DCS_Callback"+String(JRb++);this.C=this.k=null}C(IRb,K);var JRb=0;u=IRb.prototype;u.U4=function(){this.j=null;this.o.stop();this.A.callback(this.B)};
u.Eja=function(a){a instanceof Ql||(a instanceof un&&3==a.code?this.U4():(this.j=null,this.B.push(a instanceof Error?a.message:""),0<this.H--?this.o.start():this.A.errback(this.B)))};u.U4a=function(){this.o.ub()||this.o.start();var a=new Pl;Sl(this.A,a.callback,a.errback,a);return a};
u.ELa=function(){if(this.J){this.k=new ey(this.F);this.k.Dg=1E4;var a=B(this.U4,this);fa(this.q,a,void 0);this.C=this.k.send({callback:this.q},void 0,B(this.Eja,this))}else this.j&&this.j.cancel(),this.j=cdb(this.F,"dcs_main_js",{timeout:1E4}),Sl(this.j,this.U4,this.Eja,this)};u.I=function(){this.j&&this.j.cancel();this.A.cancel();ea[this.q]&&(ea[this.q]=ha);this.k&&this.C&&this.k.cancel(this.C);IRb.G.I.call(this)};function KRb(){return'<div class="docs-docos-activitybox" aria-label="Comment stream box."><div class="docs-docos-activitybox-inner"></div></div>'};function v7(a,b){Dm.call(this,b);this.j=a}C(v7,Dm);u=v7.prototype;u.T4=null;u.RL=null;u.KM=null;u.wl=null;u.Oga=!1;u.Ia=function(){v7.G.Ia.call(this);var a=this.P(),b=uu(KRb,{},{},a);this.V=b;Uh(b,!0);this.RL=a.getElement("docs-docos-caret");this.T4=bi(a,"docs-docos-activitybox-inner",b);this.j&&(im(b,"docos-enable-new-header"),im(this.RL,"docos-enable-new-header"))};
u.ba=function(){this.KM=new Vw(this.getElement());this.KM.sj("close-box",27);this.wl=new Km(this.getElement(),"toggle_display");Mm(this.wl,!0);var a=this.wl;Lm(a);a.G8=!1;this.wl.ika=!1;S(this).D(this.KM,"shortcut",this.$0a).D(this.wl,"show",this.b7a).D(this.wl,"hide",this.a7a).D(this.wl,"beforeshow",this.$6a).D(this.wl,"beforehide",this.Z6a)};u.pb=g("T4");u.b7a=function(){P(this.RL,!0);this.dispatchEvent("show")};u.a7a=function(){P(this.RL,!1)};u.$6a=function(){return this.dispatchEvent("beforeshow")};
u.Z6a=function(){return this.Oga?!1:this.dispatchEvent("hide")};u.setVisible=function(a){this.wl.setVisible(a)};u.wa=function(){return!!this.wl&&this.wl.wa()};u.$0a=function(a){switch(a.k){case "close-box":this.setVisible(!1)}};u.I=function(){M(this.KM);delete this.KM;delete this.RL;delete this.T4;M(this.wl);delete this.wl;v7.G.I.call(this)};function LRb(a,b,c,d){O.call(this);this.o=c||new lh;this.j=a;this.B=!!b;this.k=new v7(this.j.isDocsStreamHeaderEnabled&&this.j.isDocsStreamHeaderEnabled(),this.o);this.M=new R(this);this.A=new fG(void 0,void 0,!0,DN.getInstance());this.q=d||T.H0;this.j.onReady(B(this.e7a,this))}C(LRb,O);u=LRb.prototype;u.mx=null;u.Tpa=!1;u.render=ba();
u.e7a=function(){var a=this.o.getElement("docs-docos-commentsbutton");this.mx=dX(null);qA(this.mx,16);this.mx.Pa(a);Id(Ld(),"docosUnreadCommentsEnabled")&&(this.j.setListener(Docos.EventType.UNREAD_COMMENTS,this.r7a,this),this.j.setOption(Docos.OptionName.ENABLE_UNREAD_COMMENTS,!0),T.Dt.Zc(tr,this.VHa,this));kG(this.A,this.mx,T.Dt,lG);T.Dt.Zc(tr,this.w$a,this);this.k.render(a.parentNode.parentNode);P(this.k.getElement(),!1);T.Dt.Y(!0);this.j.setOption(Docos.OptionName.PANE_DIV,this.k.pb());this.j.setOption(Docos.OptionName.PANE_KB_DIV,
this.k.getElement());this.j.renderPaneSurface();this.j.setListener(Docos.OptionName.DIALOG_OPENED,B(this.mta,this));this.j.setListener(Docos.OptionName.DIALOG_CLOSED,B(this.mta,this));this.j.setOption(Docos.OptionName.SORT_PANE,!0);this.j.setOption(Docos.OptionName.STREAM_BUTTON,a);Docos.EventType.CREATE_DRAFT&&(this.j.setListener(Docos.EventType.CREATE_DRAFT,this.sKa,this),this.q.Zc(or,this.lta,this),this.lta(new Gra("enabled",this.q.isEnabled(),!1)));this.B||this.j.setListener(Docos.EventType.NETWORK_ERROR,
this.W6a,this);this.M.D(this.k,["show","hide"],this.Z5a)};u.mta=function(a){this.k.Oga=a.type==Docos.OptionName.DIALOG_OPENED};u.lta=function(a){this.j.setOption(Docos.OptionName.ENABLE_COMMENT_BUTTON,a.newValue)};u.sKa=function(){this.k.setVisible(!1);this.q.fireAction()};u.w$a=function(){var a=this.k,b;if(b=a.wl)b=a.wl,b=!(b.gC||150>Aa()-b.V9);b&&a.wl.setVisible(!0)};
function MRb(a,b){if(0>b)throw Error("Number of unread comments cannot be negative");mA(a.mx,"docs-docos-commentsbutton-unread",0<b);var c=a.o.getElement("docs-docos-commentsbutton");a.o.Mk(c,String(b))}u.r7a=function(){var a=this.j.getUnreadCommentsCount();MRb(this,a)};u.VHa=function(){MRb(this,0);this.j.ackUnreadComments()};
u.W6a=function(){if(!this.Tpa&&T.Gm.isEnabled()){if(this.j.hasPendingContent()){var a=ap("Failed to post comment due to a network error.","warning",!0);Zo.getInstance().postMessage(a)}this.j.setOption(Docos.OptionName.FATAL_READONLY,!0);this.j.setOption(Docos.OptionName.SHOW_ERRORS,!0);T.H0.Y(!1,"docos-fatal-reason");this.Tpa=!0}};u.Z5a=function(a){a="show"==a.type;this.j.setOption(Docos.OptionName.SORT_PANE,!a);this.mx.Qb(a);a?this.j.grabFocus():this.dispatchEvent("activity-box-closed")};
u.I=function(){M(this.mx);delete this.mx;M(this.M);delete this.M;M(this.k);delete this.k;M(this.A);delete this.A;delete this.j;LRb.G.I.call(this)};function NRb(){K.call(this)}C(NRb,xn);u=NRb.prototype;u.NNa=function(){return IRb};u.mOa=function(){return t7};u.oOa=function(){return LRb};u.jOa=function(){return aRb};u.kOa=function(){return hRb};u.lOa=function(){return iRb};u.nOa=function(){return kRb};Jn("docos",NRb);
