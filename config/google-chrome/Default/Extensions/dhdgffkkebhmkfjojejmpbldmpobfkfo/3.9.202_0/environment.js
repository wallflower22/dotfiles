Registry.registerRaw("environment.js","202",function(){Context.domContentLoaded=!1;Context.loadHappened=!1;Context.domNodeInserted=!1;Context.props={};Context.adjustLogLevel=function(a){void 0!==a&&(logLevel=a);D|=60<=logLevel};var r=function(){var a={objs:{},push:function(c,b){0!==b&&1!==b&&(b=0);var d=Math.floor(19831206*Math.random()+1);a.objs[d]={fn:c,prio:b};return d},remove:function(c){delete a.objs[c]},get:function(c){for(var b=[],d=0;1>=d;d++)for(var h in a.objs)a.objs.hasOwnProperty(h)&&
(a.objs[h].prio!==d||void 0!==c&&h!=c||b.push(a.objs[h].fn));return void 0===c?b:b[0]},finalize:function(c){if(void 0===c){c=a.get();for(var b=0;b<c.length;b++)c[b]()}else return a.objs[c]&&(b=a.objs[c].fn(),delete a.objs[c]),b}};return a}();Context.adjustLogLevel();var K=function(a){return{}.toString.apply(a).match(/\s([a-z|A-Z]+)/)[1]},A=function(a,c){void 0==c&&(c=100);return c&&a&&(a==document||A(a.parentNode,c-1))},O=function(){var a=function(){};a.prototype={};return new a},Y=function(){var a=
O(),c=function(a,b,d,c,e,k){var g=d[c];d[c]=k&&"string"===typeof g?new Function(g):function(){return g.apply(e,arguments)};return b.apply(a,d)},b={setTimeout:{enhance:function(){return c(window,safeWindow.setTimeout,arguments,0,a,!0)}},setInterval:{enhance:function(){return c(window,safeWindow.setInterval,arguments,0,a,!0)}},close:{get:function(){return window.self==window.top?function(a){return X(a)}:window.close}},location:{get:!0,set:function(a){window.location.href=a}},clearInterval:{get:function(){return safeWindow.clearInterval}},
clearTimeout:{get:function(){return safeWindow.clearTimeout}},addEventListener:{enhance:function(){return c(window,safeWindow.addEventListener,arguments,1,a,!0)}},removeEventListener:{enhance:function(){return c(window,safeWindow.removeEventListener,arguments,1,a,!0)}}},d=function(b){return b==window?a:b},h=function(a,b,d,c){d||(d=a);var e=function(){var e=a[b].apply(d,arguments);c&&(e=c(e));return e};e.__proto__=a[b];e.prototype=a[b].prototype;return e},g=function(b){var d,c,e=null,e=function(e){d=
e;c=function(){return e.apply(a,arguments)};window[b]=c};a.__defineGetter__(b,function(){return void 0===d||c!==window[b]?window[b]:d});a.__defineSetter__(b,e)},f=function(b,e,c){var k,g=null,h=null,g="function"===typeof e.get?e.get:function(){c&&c.get_cb&&c.get_cb.apply(this,arguments);return void 0===k?d(window[b]):k};"function"===typeof e.set?h=e.set:e.get||(h=function(a){c&&c.set_cb&&c.set_cb.apply(this,arguments);k=a});g&&a.__defineGetter__(b,g);h&&a.__defineSetter__(b,h)};(function(){var a=
0,b=function(b){for(var e=a;e<b;e++)f(String(e),{get:!0});a=Math.max(b,a)};f("length",{},{get_cb:function(){b(window.frames.length)}});b(Math.max(window.frames.length,7))})();for(var e in b)b.hasOwnProperty(e)&&(Context.windowProps[e]=Context.windowProps[e]||!1!==b[e]);var k;for(e in Context.windowProps)if(Context.windowProps.hasOwnProperty(e)&&!1!==b[e]){k={};try{try{b[e]?b[e].wrap?(k.wrap=!0,k.that=b[e].that):b[e].direct?k.direct=!0:b[e].enhance?k.enhance=b[e].enhance:b[e].get&&(k.get=b[e].get,
k.set=b[e].set):"function"===typeof window[e]?Context.windowProps[e].proto?k.wrap=!0:k.direct=!0:"number"===typeof window[e]||"string"===typeof window[e]?k.get=!0:Context.windowProps[e].event&&Context.windowProps[e].proto?k.event=!0:k.direct=!0}catch(u){k.get=!0}k.direct?a[e]=d(window[e]):k.enhance?a[e]=k.enhance:k.event?g(e):k.get||k.set?f(e,k):k.wrap&&function(){var b=e;a[b]=h(window,b,k.that,d)}()}catch(p){console.warn("env: error while creating a new sandbox: "+p.message)}}B(a,1);return a},Z=
function(a,c,b,d,h){var g=null;try{var f=d.sandboxes[a.uuid];f.__TMbackref||(f.__TMbackref={});var e='arguments.callee.__tmid = { uuid: "'+a.uuid+'", run_at: "'+a.options.run_at+'" };\n',k=["context"],u=[void 0],p;for(p in d.elements[a.uuid])if(d.elements[a.uuid].hasOwnProperty(p)){var n=d.elements[a.uuid][p];n.name?n.overwrite?(k.push(n.name),u.push(n.value)):n.scriptid?(f.__TMbackref[n.name+"_"+n.scriptid]=n.value,k.push(n.name),u.push('context.__TMbackref["'+n.name+"_"+n.scriptid+'"]')):(f[n.name]=
n.value,k.push(n.name),u.push("context."+n.name)):D&&console.warn("env: WARN: unexpected item in props elem: "+JSON.stringify(n))}g=[e,"with (context) {\n(function(",k.join(","),") {try {\n",b,c,"\n} catch (e) {if (e.message && e.stack) {console.error(\"ERROR: Execution of script '",a.name.replace(/(['"])/g,"\\$1"),'\' failed! " + e.message);console.log(e.stack.replace(/(\\\\(eval at )?<anonymous>[: ]?)|([\\s.]*at TM_mEval[\\s\\S.]*)/g, ""));} else {console.error(e);}};\n}).apply(context, [',u.join(","),
"]);}\n"].join("");d=function(a,b){(new Function("context",g)).apply(b,[b])};h?h(d,[g,f]):d(g,f)}catch(l){chromeEmu.extension.sendMessage({method:"syntaxCheck",code:[b,c].join("")},function(e){var d="";if(e.errors){var d=b.split("\n").length-1,k="",g;for(g in e.errors){var h=e.errors[g];if(h&&0<=h.line&&h.reason)var f=h.line,k=k+[f>d?"script:":"require:"," (",h.code,") ",h.reason.replace(/.$/,"")," on line: ",f>d?f-d:f," at character: ",h.character,"\n"].join("")}d="JSHINT output:\n"+k}else d=c;g=
l.stack?l.stack.replace(/(\\(eval at )?<anonymous>[: ]?)|([\s.]*at TM_mEval[\s\S.]*)/g,""):"";D||e.errors?console.error("Syntax error @ '"+a.name+"'!\n##########################\n"+d+"##########################\n\n"+g):console.error("Syntax error @ '"+a.name+"'!\n\n",g);safeWindow.setTimeout(function(){D&&chromeEmu.extension.sendMessage({method:"copyToClipboard",data:{content:c,type:"test"},id:"42"},function(){});throw l;},1)})}},v=[],l={events:[],done:{},running:null},w=function(a,c,b,d){var h={attrChange:0,
attrName:null,bubbles:!0,cancelBubble:!1,cancelable:!1,clipboardData:void 0,currentTarget:null,defaultPrevented:!1,eventPhase:0,newValue:null,prevValue:null,relatedNode:null,returnValue:!0,srcElement:null,target:null,timeStamp:(new Date).getTime()};b="string"===typeof b?new Function(b):b;var g=new Event,f;for(f in h)g[f]=h[f];for(f in c)g[f]=c[f];g.type=a;b.apply(d,[g])},C=function(a){Context.loadHappened=!0;Context.domContentLoaded=!0;D&&console.log("env: DOMContentLoaded Event!");y()},E=function(a){Context.domNodeInserted||
!D||console.log("env: first DOMNodeInserted Event!");Context.loadHappened=!0;Context.domNodeInserted=!0;l&&l.events.push({event:a,domContentLoaded:Context.domContentLoaded})},F=function(a){Context.loadHappened=!0;D&&console.log("env: load Event!")},G=function(){safeDocument.removeEventListener("DOMNodeInserted",E,!1);safeDocument.removeEventListener("DOMContentLoaded",C,!1);safeDocument.removeEventListener("load",F,!1);safeWindow.removeEventListener("unload",G,!1);if(null!=r){for(var a=r.get(),c=
0;c<a.length;c++)a[c]();r=null}chromeEmu.clean&&chromeEmu.clean()},y=function(){for(var a=v.length;0<v.length;){var c=v.shift();try{safeWindow.setTimeout(c.fn,1)}catch(b){console.log("ERROR: Execution (loadListener) of script env "+c.name+" failed!"+b.message)}}return a},H=function(a,c){if(document.body)safeWindow.setTimeout(function(){a()},1);else{var b=function(){safeDocument.removeEventListener("load",b,!1);safeDocument.removeEventListener("DOMNodeInserted",b,!1);safeDocument.removeEventListener("DOMContentLoaded",
b,!1);H(a,c)};safeDocument.addEventListener("load",b,!1);safeDocument.addEventListener("DOMNodeInserted",b,!1);safeDocument.addEventListener("DOMContentLoaded",b,!1)}},$=function(a,c,b){v.push({fn:function(){a()},name:b});Context.domContentLoaded?y():D&&console.log("env: schedule for later events!")},s=[],B=function(a,c){if(!a.__addEventListener){a.__addEventListener=a.addEventListener;a.__removeEventListener=a.removeEventListener;a.removeEventListener=function(a,b,c){"DOMNodeInserted"==a&&l&&l.running==
b&&(l.running=null);this.__removeEventListener(a,b,c)};var b=function(a,b,c,f){if(b){var e=s.length;b=parseInt(["DOMContentLoaded"==c?1:2,f?1:2,f?b:3-b,(new Date).getTime()].join("0"));for(c=0;c<s.length;c++)if(f=s[c],!f||!f.prio||f.prio>b){e=c;break}s.splice(e,0,{prio:b,fn:a})}else s.push({fn:a})};a.addEventListener=function(a,h,g){var f=!0;if("load"==a||"DOMContentLoaded"==a||"DOMNodeInserted"==a){var e=null,k=this;try{e=I(arguments.callee)}catch(u){D&&console.error("env: Error: event "+a,u)}if(e){var p=
null;"load"==a?Context.loadHappened&&(p=function(){w("load",{attrName:"null",newValue:"null",prevValue:"null",eventPhase:Event.AT_TARGET,attrChange:MutationEvent.ADDITION,target:document,relatedNode:document,srcElement:document},h,k)},f=!1,b(p,c,a,g)):"DOMContentLoaded"==a?Context.domContentLoaded&&(p=function(){w("DOMContentLoaded",{attrName:"null",newValue:"null",prevValue:"null",eventPhase:Event.AT_TARGET,attrChange:MutationEvent.ADDITION,target:document,relatedNode:document,srcElement:document},
h,k)},f=!1,b(p,c,a,g)):"DOMNodeInserted"==a&&l&&!l.done[e.uuid]&&(l.done[e.uuid]=!0,p=function(){var b="document-start"!=e.run_at&&"document-body"!=e.run_at;l.running=h;if(l.running){a:if(l)for(var c=l.events.length,f=0;f<c;f++)if(b&&!l.events[f].domContentLoaded||w("DOMNodeInserted",{attrName:"",newValue:"",prevValue:"",eventPhase:Event.AT_TARGET,target:l.events[f].event.target,relatedNode:l.events[f].event.relatedNode,srcElement:l.events[f].event.srcElement},h,k),!l.running)break a;k.__addEventListener(a,
h,g)}l.running=null},b(p));p&&(safeWindow.setTimeout(function(){if(s.length){var a=s.shift();a&&a.fn&&a.fn()}},1),f=!1)}}f&&this.__addEventListener(a,h,g)};r.push(function(){a.removeEventListener=a.__removeEventListener;a.addEventListener=a.__addEventListener})}Context.windowProps.__addEventListener={proto:!0};Context.windowProps.__removeEventListener={proto:!0}},I=function(a,c){void 0===c&&(c=20);return 0==c?null:!a.__tmid&&a.caller?I(a.caller,c-1):a.__tmid},P=function(a){r.finalize(a)},M=function(a,
c,b){var d=TM_context_id+"#"+a,h=null,h=r.push(function(){chromeEmu.extension.sendMessage({method:"unRegisterMenuCmd",name:a,id:d},function(a){})},1);chromeEmu.extension.sendMessage({method:"registerMenuCmd",name:a,id:TM_context_id,menuId:d,accessKey:b},function(d){d.run&&null!==h&&void 0!==r.get(h)?(safeWindow.setTimeout(function(){c()},1),M(a,c,b)):null!==h&&(r.remove(h),h=null)});return h},Q=function(a,c){var b=!1,d=null,h=chromeEmu.extension.connect("openInTab_"+TM_context_id);a&&0==a.search(/^\/\//)&&
(a=window.location.protocol+a);h.onMessage.addListener(function(a){a.tabId?b&&g():a.close&&(b=!0,d&&(d(),d=void 0))});h.onDisconnect.addListener(function(){h=null});h.postMessage({method:"openInTab",details:{url:a,id:TM_context_id,options:c},id:TM_context_id});var g=function(){h&&h.postMessage({method:"closeTab",id:TM_context_id})},f={close:function(){b?D&&console.debug("env: attempt to close already closed tab!"):(b=!0,g())}};f.__defineGetter__("closed",function(){return b});f.__defineGetter__("onclose",
function(){return d});f.__defineSetter__("onclose",function(a){d=a});return f},R=function(a,c){var b=!1,d="Object"===K(a)?a:{url:a,name:c};d.url&&"/"===d.url[0]&&(d.url=window.location.origin+d.url);var h=d.context;delete d.context;var g=chromeEmu.extension.connect("download_"+TM_context_id);g.postMessage({method:"download",details:d,id:TM_context_id});var f=function(a,c){c=c||{};a&&!b&&safeWindow.setTimeout(function(){a.apply(c,[c])},1)};g.onMessage.addListener(function(a){try{a.data&&h&&(a.data.context=
h),a.success?d.onload&&(a.data.responseXML&&(a.data.responseXML=safeWindow.unescape(a.data.responseXML)),f(d.onload,a.data)):a.progress?d.onprogress&&f(d.onprogress,a.data):a.timeout?d.ontimeout&&f(d.ontimeout,a.data):d.onerror&&f(d.onerror,a.data)}catch(b){console.log("env: Error: TM_download - ",b,d)}});return{abort:function(){b=!0}}},S=function(a){var c=!1;a.url&&"/"===a.url[0]&&(a.url=window.location.origin+a.url);var b=a.context;delete a.context;var d=function(){var a={};Object.getOwnPropertyNames(XMLHttpRequest.__proto__).forEach(function(b){a[b]=
!0});var b=function(){};Object.getOwnPropertyNames(XMLHttpRequest).forEach(function(c){a[c]||(b[c]=XMLHttpRequest[c])});return b}(),h=function(a,b){b=b||{};a&&!c&&safeWindow.setTimeout(function(){b.__proto__=d;a.apply(b,[b])},1)},g=function(b){if(b.response2&&a.responseType){var c,e=a.responseType.toLowerCase(),d=b.response2;delete b.response2;var g=function(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=d.charCodeAt(c);return b.buffer};"arraybuffer"==e?c=g(d):"blob"==e?c=new Blob([g(d)]):
"json"==e&&(c=JSON.parse(d));c&&(b.response=c)}return b};if("FormData"!==K(a.data)){var f=chromeEmu.extension.connect("xhr_"+TM_context_id);f.postMessage({method:"xhr",details:a,id:TM_context_id});f.onMessage.addListener(function(c){try{c.data&&b&&(c.data.context=b),c.success?a.onload&&(c.data.responseXML&&(c.data.responseXML=safeWindow.unescape(c.data.responseXML)),h(a.onload,g(c.data))):c.change?a.onreadystatechange&&h(a.onreadystatechange,c.data):c.progress?a.onprogress&&h(a.onprogress,c.data):
c.timeout?a.ontimeout&&h(a.ontimeout,c.data):a.onerror&&h(a.onerror,c.data)}catch(d){console.log("env: Error: TM_xmlhttpRequest",d,a)}})}else{var e=new XMLHttpRequest;void 0===a.async&&(a.async=!0);e.open(a.method,a.url,a.async,a.user,a.password);if(a.headers)for(f in a.headers)e.setRequestHeader(f,a.headers[f]);a.overrideMimeType&&e.overrideMimeType(a.overrideMimeType);a.responseType&&(e.responseType=a.responseType);"abort error load progress readystatechange timeout".split(" ").forEach(function(c){e["on"+
c]=function(){var d="",g=a.url;if(2<e.readyState&&(d=e.getAllResponseHeaders(),4==e.readyState)){d&&(d=d.replace(/TM-finalURL\: .*[\r\n]{1,2}/,""));var f=e.getResponseHeader("TM-finalURL");f&&(g=f)}d={readyState:e.readyState,status:"",statusText:"",responseHeaders:d,finalUrl:g,context:b};4==e.readyState&&(e.responseType&&""!=e.responseType?d.response=e.response:(d.responseText=e.responseText,d.responseXML=e.responseXML),d.status=e.status,d.statusText=e.statusText);h(a["on"+c],d)}});e.send(a.data)}return{abort:function(){c=
!0}}},T=function(a,c){chromeEmu.extension.sendMessage({method:"installScript",url:a,id:TM_context_id},function(a){c&&c(a)})},X=function(a){chromeEmu.extension.sendMessage({method:"closeTab",id:TM_context_id},function(c){c.error&&console.warn(c.error);a&&a()})},aa=function(a,c){var b=[],d=a.storage,h=a.script.uuid,g=a.script,f=null;(function(){f=chromeEmu.extension.connect("storageListener_"+TM_context_id);f.onMessage.addListener(function(a){if(a.storage)for(var b in a.storage.data)if(a.storage.data.hasOwnProperty(b)){var e=
d.data[b];d.data[b]=a.storage.data[b];l(b,e,d.data[b],!0)}a.removed&&(d[a.removed]=c);a.error&&console.log("env: Error: storage listener... :(")});f.postMessage({method:"addStorageListener",uuid:h,id:TM_context_id})})();var e=function(a){f.postMessage({method:"saveStorageKey",uuid:h,key:a,value:d.data[a],id:TM_context_id,ts:d.ts})},k=function(a,b,d){d===c&&(d=function(a){return a});var e=[],g=null;if(a&&a.length){var g={GM_info:!0},f;for(f in a)if(a.hasOwnProperty(f)){var h=a[f];g[h]=!0}}for(f in b)b.hasOwnProperty(f)&&
(h=b[f],g&&!g[d(h.name)]||e.push(h));return e},l=function(a,c,d,e){if(c!=d)for(var g in b)if(b.hasOwnProperty(g)){var f=b[g];if(f&&f.key==a&&f.cb)try{f.cb(a,w(c),w(d),e)}catch(h){D&&console.warn("env: value change listener of '"+a+"' failed with: "+h.message)}}},p=function(a,c){var d=0,e;for(e in b)b.hasOwnProperty(e)&&b[e].id>d&&(d=e.id);d++;b.push({id:d,key:a,cb:c});return d},n=function(a){for(var c in b)if(b.hasOwnProperty(c)&&b[c].id==a)return delete b[c],!0},s=function(a){var b=d.data[a];d.ts=
(new Date).getTime();delete d.data[a];e(a);l(a,b,d.data[a],!1)},v=function(){var a=[],b;for(b in d.data)d.data.hasOwnProperty(b)&&a.push(b);return a},w=function(a,b){if("string"===typeof a){var c=a[0];a=a.substring(1);switch(c){case "b":return"true"===a;case "n":return Number(a);case "o":try{return JSON.parse(a)}catch(d){console.log("env: parseValueFromStorage: "+d)}return b;default:return a}}else return b},y=function(a,b){return w(d.data[a],b)},A=function(a,b){var c=d.data[a],g=(typeof b)[0];switch(g){case "o":try{b=
g+JSON.stringify(b)}catch(f){console.log(f);return}break;default:b=g+b}d.ts=(new Date).getTime();d.data[a]=b;e(a);l(a,c,d.data[a],!1)},B=function(a){for(var b in g.resources){var c=g.resources[b];if(c.name==a)return c.resText}return null},C=function(a){for(var b in g.resources){var c=g.resources[b];if(c.name==a)return c.resURL}return null},E=function(a){console.log(a)},F=function(a){try{var b=safeDocument.createElement("style");b.textContent=a;(document.head||document.body||document.documentElement||
document).appendChild(b);return b}catch(c){console.log("Error: env: adding style "+c)}},G=function(b,d,e,g,f){var h,k=null;d||(d=a.script.name);if(f){var l=typeof f;"number"===l?h=f:"object"===l&&(k=f.onclose,h=f.timeout)}e==c&&(e=a.script.icon?a.script.icon:a.script.icon64);chromeEmu.extension.sendMessage({method:"notification",delay:h,msg:b,image:e,title:d,id:TM_context_id},function(a){a.clicked&&g&&g();k&&k(!0===a.clicked)})},H=function(a,b,c){var d=typeof b,e="text",f="text/plain";"object"===
d?(b.type&&(e=b.type),b.mimetype&&(f=b.mimetype)):"string"===d&&(e=b);chromeEmu.extension.sendMessage({method:"copyToClipboard",data:{content:a,type:e,mimetype:f},id:TM_context_id},function(a){c&&c()})},I=function(a){chromeEmu.extension.sendMessage({method:"getTab",id:TM_context_id,uid:g.uuid},function(b){a&&a(b.data)})},L=function(a,b){chromeEmu.extension.sendMessage({method:"setTab",id:TM_context_id,tab:a,uid:g.uuid},function(a){b&&b()})},U=function(a){chromeEmu.extension.sendMessage({method:"getTabs",
id:TM_context_id,uid:g.uuid},function(b){a&&a(b.data)})},m=function(a,b){var c=window,d="__u__"+Math.floor(19831206*Math.random()+1),e=d+"_";c[d]=a;c[e]=b;var f=Context.eval('window["'+d+'"].apply(this, window["'+e+'"])');delete c[d];delete c[e];return f},q=[],x=null,t;for(t in g.grant)if(g.grant.hasOwnProperty(t)&&"none"===g.grant[t]){x=m;break}var z=g.namespace+"_"+!!x;Context.props[z]===c&&(Context.props[z]={sandboxes:{},elements:{}},r.push(function(){Context.props[z]=null}));if(!x){q.push({name:"window",
value:"context",overwrite:!0});var N={window:window};for(t in N)N.hasOwnProperty(t)&&function(){var a=t.replace(/^(.)/g,function(a){return a.toUpperCase()});q.push({name:"unsafe"+a,value:N[t]})}()}q.push({name:"CDATA",value:function(a){this.src=a;this.toXMLString=this.toString=function(){return this.src}}});q.push({name:"uneval",value:function(a){try{return"\\$1 = "+JSON.stringify(a)+";"}catch(b){console.log(b)}}});q.push({name:"undefined",value:c});q.push({name:"define",value:c});q.push({name:"module",
value:c});q.push({name:"console",value:console});x||(q.push({name:"cloneInto",value:function(a,b,c){return a}}),q.push({name:"exportFunction",value:function(a,b,d){d&&d.defineAs!==c&&(b[d.defineAs]=a);return a}}),q.push({name:"createObjectIn",value:function(a,b){var d={};b&&b.defineAs!==c&&(a[b.defineAs]=d);return d}}));m=[];m.push({name:"TM_addStyle",value:F});m.push({name:"TM_deleteValue",value:s});m.push({name:"TM_listValues",value:v});m.push({name:"TM_getValue",value:y});m.push({name:"TM_log",
value:E});m.push({name:"TM_registerMenuCommand",value:M});m.push({name:"TM_unregisterMenuCommand",value:P});m.push({name:"TM_openInTab",value:Q});m.push({name:"TM_setValue",value:A});m.push({name:"TM_addValueChangeListener",value:p});m.push({name:"TM_removeValueChangeListener",value:n});m.push({name:"TM_xmlhttpRequest",value:S});m.push({name:"TM_download",value:R});m.push({name:"TM_setClipboard",value:H});m.push({name:"TM_getTab",value:I});m.push({name:"TM_setTab",value:L});m.push({name:"TM_saveTab",
value:L});m.push({name:"TM_getTabs",value:U});m.push({name:"TM_installScript",value:T});m.push({name:"TM_notification",value:G});m.push({name:"TM_getResourceText",value:B,scriptid:g.uuid});m.push({name:"TM_getResourceURL",value:C,scriptid:g.uuid});var J=[],V=new function(){this.GM_addStyle=function(a){return F(a)};this.GM_deleteValue=function(a){return s(a)};this.GM_listValues=function(){return v()};this.GM_getValue=function(a,b){return y(a,b)};this.GM_addValueChangeListener=function(a,b){return p(a,
b)};this.GM_removeValueChangeListener=function(a){return n(a)};this.GM_log=function(a){return E(a)};this.GM_registerMenuCommand=function(a,b,c){return M(a,b,c)};this.GM_unregisterMenuCommand=function(a){return P(a)};this.GM_openInTab=function(a,b){return Q(a,b)};this.GM_setValue=function(a,b){return A(a,b)};this.GM_xmlhttpRequest=function(a){return S(a)};this.GM_download=function(){return R.apply(this,arguments)};this.GM_getResourceText=function(a){return B(a)};this.GM_getResourceURL=function(a){return C(a)};
this.GM_notification=function(a,b,c,d,e){return G(a,b,c,d,e)};this.GM_installScript=function(a,b){return T(a,b)};this.GM_getTab=function(a){return I(a)};this.GM_setTab=function(a,b){return L(a,b)};this.GM_saveTab=function(a){return L(a)};this.GM_getTabs=function(a){return U(a)};this.GM_setClipboard=function(a,b,c){return H(a,b,c)};Object.defineProperties(this,{GM_info:{get:function(){var b={observers:1,id:1,enabled:1,hash:1,fileURL:1},c={script:{}},d;for(d in g)g.hasOwnProperty(d)&&!b[d]&&(c.script[d]=
g[d]);b=g.options.updateURL||g.options.fileURL;c.script["run-at"]=g.options.override.run_at||g.options.run_at;c.script.excludes=g.options.override.orig_excludes;c.script.includes=g.options.override.orig_includes;c.script.matches=g.options.override.orig_includes;c.script.grant=g.grant;c.script.unwrap=!1;c.scriptMetaStr=a.header;c.scriptSource=a.code;c.scriptWillUpdate=!!b;c.scriptUpdateURL=b;c.version=a.version;c.scriptHandler="Tampermonkey";c.isIncognito=Context.isIncognito;return c},enumerable:!0,
configurable:!0}})},W=[];for(t in V)W.push({name:t,value:V[t]});J=J.concat(k(g.grant,m,function(a){return a.replace(/^TM_/,"GM_")}));J=J.concat(k(g.grant,W));q=q.concat(J);g.options.compat_prototypes&&(D&&console.log("env: option: add toSource"),Object.prototype.toSource||Object.defineProperties(Object.prototype,{toSource:{value:function(){var a=K(this);if("String"===a)return"(String('"+this.replace(/\'/g,"\\'")+"'))";if("Number"===a)return"(Number('"+Number(this)+"'))";if("Array"===a){for(var b=
"(new Array(",c=0;c<this.length;c++)a=K(this[c]),b="Null"===a?b+"null":"Undefined"===a?b+"undefined":b+this[c].toSource(),c+1<this.length&&(b+=",");return b+"))"}return"JSON.parse(unescape('"+safeWindow.escape(JSON.stringify(this))+"'))"},enumerable:!1,writable:!0,configurable:!0}}),D&&console.log("env: option: add some array generics"),"indexOf lastIndexOf filter forEach every map some slice".split(" ").forEach(function(a){if("function"!==typeof Array[a]){var b={};b[a]={value:function(b){return Array.prototype[a].apply(b,
Array.prototype.slice.call(arguments,1))},enumerable:!1,writable:!0,configurable:!0};Object.defineProperties(Array,b)}}));Context.props[z].sandboxes[a.script.uuid]=x?O():Y();Context.props[z].elements[a.script.uuid]=q;D&&console.debug("env: execute script "+g.name+" @ the "+(x?"un":"")+"safe context now!");Z(g,a.code,a.requires,Context.props[z],x);r.push(function(){f.postMessage({method:"removeStorageListener",uuid:h,storage:d,id:TM_context_id});try{f.disconnect(),f=null}catch(c){}a=b=null})};chromeEmu.extension.onMessage.addListener(function(a,
c,b){if(a.id&&a.id!=TM_context_id)console.warn("env: Not for me! "+TM_context_id+"!="+a.id);else if(c=window.self==window.top,"executeScript"==a.method)c=function(){aa(a);b({})},"document-start"==a.script.options.run_at?(D&&console.debug("env: run '"+a.script.name+"' ASAP -> document-start"),c()):"document-body"==a.script.options.run_at?(D&&console.debug("env: schedule '"+a.script.name+"' for document-body"),H(c,a.script.uuid)):(D&&console.debug("env: schedule '"+a.script.name+"' for document-end"),
$(c,a.script.uuid,a.script.name));else if("onLoad"==a.method){Context.domContentLoaded=!0;y();b({});var d=null,h=function(){l=d=null};r.push(function(){d&&safeWindow.clearTimeout(d);h()});d=safeWindow.setTimeout(h,2E3)}else c&&("loadUrl"==a.method?(window.location=a.url,b({})):"reload"==a.method?(window.location.reload(),b({})):"confirm"==a.method?safeWindow.setTimeout(function(){var c=safeWindow.confirm(a.msg);b({confirm:c})},100):"showMsg"==a.method?safeWindow.setTimeout(function(){safeWindow.setTimeout(function(){safeWindow.alert(a.msg)},
1);b({})},100):console.log("env: unknown method "+a.method))});(function(a){a.__evaluate||(a.__evaluate=a.evaluate,a.evaluate=function(a,b,d,h,g){b||(b=this);var f;if("undefined"!=typeof XPathResult){var e=null;try{f=this.__evaluate(a,b,d,h,g)}catch(k){e=k}var l=!1;try{l|=!!f.snapshotLength}catch(p){}try{l|=!!f.singleNodeValue}catch(n){}if(!l&&"."!=a.charAt(0)&&!A(b)){a=("/"==a.charAt(0)?".":"./")+a;try{f=this.__evaluate(a,b,d,h,g)}catch(r){}}if(!l&&e)throw e;}else f=b.selectNodes(a);return f},r.push(function(){a.evaluate=
a.__evaluate}))})(window.HTMLDocument.prototype);B(window.HTMLDocument.prototype,2);safeDocument.addEventListener("DOMNodeInserted",E,!1);safeDocument.addEventListener("DOMContentLoaded",C,!1);safeDocument.addEventListener("load",F,!1);safeWindow.addEventListener("unload",G,!1);D&&console.debug("env: initialized (content, id:"+TM_context_id+", "+window.location.origin+window.location.pathname+") ")});
